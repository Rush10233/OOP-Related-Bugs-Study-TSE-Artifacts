<!DOCTYPE html>
<html><head><meta charset="utf-8"/><title>⚙ D60912 MS ABI: handle inline static data member and inline variable as template static data member</title><meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/><link color="#3D4B67" href="overrides/favicon/mask-icon.svg" rel="mask-icon"/><link href="overrides/favicon/favicon-76" rel="apple-touch-icon" sizes="76x76"/><link href="overrides/favicon/favicon-120" rel="apple-touch-icon" sizes="120x120"/><link href="overrides/favicon/favicon-152" rel="apple-touch-icon" sizes="152x152"/><link href="overrides/favicon/favicon" id="favicon" rel="icon"/><meta content="no-referrer" name="referrer"/><link href="overrides/css/differential.pkg.css" rel="stylesheet" type="text/css"/><link href="overrides/css/core.pkg.css" rel="stylesheet" type="text/css"/><script src="overrides/js/init.js" type="text/javascript"></script></head><body class="device-desktop platform-linux phui-theme-blindigo" id=""><div class="main-page-frame" data-autoid="autoid_16" id="main-page-frame"><div class="phabricator-standard-page" id="phabricator-standard-page"><div class="phabricator-main-menu phabricator-main-menu-background" id="UQ0_75"><a class="phabricator-core-user-menu phabricator-core-user-mobile-menu" data-meta="0_208" data-sigil="phui-dropdown-menu" href="#" role="button"><span class="aural-only">Page Menu</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-bars" data-meta="0_209"></span><span class="caret"></span></a><a class="phabricator-main-menu-search-button phabricator-expand-application-menu" data-meta="0_207" data-sigil="jx-toggle-class"><span class="phabricator-menu-button-icon phui-icon-view phui-font-fa fa-search" id="UQ0_92"></span></a><a class="phabricator-main-menu-brand" href="/"><span class="aural-only">Home</span><span class="phabricator-main-menu-eye" style=""></span><span class="phabricator-wordmark">Phabricator</span></a></div><div style="background-color: crimson; color: white; text-align: center; padding: 0.3rem 0;"><h1>This is an archive of the discontinued LLVM Phabricator instance.</h1></div><div class="phabricator-standard-page-body" id="phabricator-standard-page-body"><table class="phui-formation-view" data-meta="0_206" data-sigil="phuix-formation-view" id="UQ0_73"><tbody><tr><td class="phui-formation-desktop-only" data-autoid="autoid_1" id="UQ0_2" style="width: 240px; display: none;"><div class="phui-flank-view phui-flank-view-fixed" id="UQ0_6" style="width: 240px; top: 44px;"><div class="phui-flank-view-head" id="UQ0_3"><div class="phui-flank-header"><div class="phui-flank-header-text">Paths</div><div class="phui-flank-header-hide phui-flank-header-hide-left" data-sigil="phui-flank-header-hide"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-chevron-left grey" data-meta="0_0"></span></div></div><ul class="phui-list-view"><li class="phui-list-item-view phui-list-item-type-link phui-list-item-has-icon"><a class="phui-list-item-href" data-meta="0_1" data-sigil="has-key-command" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-list phui-list-item-icon" data-meta="0_2"></span><span class="phui-list-item-name">Table of Contents</span><span class="keyboard-shortcut-key">t</span></a></li></ul></div><div class="phui-flank-view-body" id="UQ0_4" style="max-height: 0px;"><ul class="diff-tree-view"><li class="diff-tree-path" data-autoid="autoid_11"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">lib/CodeGen/</div></div></li><li class="diff-tree-path" data-autoid="autoid_12" style="display: none;"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">CodeGen/</div></div></li><li class="diff-tree-path diff-tree-path-changeset" data-autoid="autoid_8"><div class="diff-tree-path-indent" style="margin-left: 8px;"><div class="diff-tree-path-inlines diff-tree-path-inlines-visible">1/4</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-file-text-o bluetext"></span></div><div class="diff-tree-path-name">CGDeclCXX.cpp</div></div></li><li class="diff-tree-path" data-autoid="autoid_13"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">test/</div></div></li><li class="diff-tree-path" data-autoid="autoid_14"><div class="diff-tree-path-indent" style="margin-left: 8px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">CodeGenCXX/</div></div></li><li class="diff-tree-path diff-tree-path-changeset" data-autoid="autoid_9"><div class="diff-tree-path-indent" style="margin-left: 16px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-plus create-color"></span></div><div class="diff-tree-path-name">microsoft-abi-template-static-init.cpp</div></div></li><li class="diff-tree-path" data-autoid="autoid_15"><div class="diff-tree-path-indent" style="margin-left: 8px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">Modules/</div></div></li><li class="diff-tree-path diff-tree-path-changeset" data-autoid="autoid_10"><div class="diff-tree-path-indent" style="margin-left: 16px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-file-text-o bluetext"></span></div><div class="diff-tree-path-name">initializers.cpp</div></div></li></ul></div><div class="phui-flank-view-tail" id="UQ0_5"><ul class="phui-list-view"><li class="phui-list-item-view phui-list-item-type-link phui-list-item-has-icon"><a class="phui-list-item-href" data-meta="0_3" data-sigil="has-key-command" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-chevron-left phui-list-item-icon" data-meta="0_4"></span><span class="phui-list-item-name">Hide Panel</span><span class="keyboard-shortcut-key">f</span></a></li><li class="phui-list-item-view phui-list-item-type-link phui-list-item-has-icon"><a class="phui-list-item-href" data-meta="0_5" data-sigil="has-key-command" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-keyboard-o phui-list-item-icon" data-meta="0_6"></span><span class="phui-list-item-name">Keyboard Reference</span><span class="keyboard-shortcut-key">?</span></a></li></ul></div></div></td><td class="phui-formation-desktop-only" data-autoid="autoid_3" id="UQ0_7" style="width: 8px; display: none;"><div class="phui-formation-resizer" id="UQ0_8" style="width: 8px;"></div></td><td class="" data-autoid="autoid_4" id="UQ0_9" style=""><div class="phui-formation-view-content"><div class="phui-crumbs-view phui-crumbs-border"><a class="phui-crumb-view phui-crumb-has-icon" href="/differential/"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-cog" data-meta="0_7"></span><span class="phui-crumb-name"> Differential</span> </a><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-angle-right phui-crumb-divider phui-crumb-view" data-meta="0_8"></span><span class="phui-crumb-view phabricator-last-crumb"><span class="phui-crumb-name"> D60912</span> </span></div><div class="phui-two-column-view phui-side-column-right with-subheader"><div class="phui-two-column-container"><div class="phui-two-column-header"><div class="phui-header-shell phui-header-tall"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-cog phui-header-icon" data-meta="0_200"></span>MS ABI: handle inline static data member and inline variable as template static data member</span><div class="phui-header-subheader"><span class="phui-tag-view phui-tag-type-shade phui-tag-indigo phui-tag-shade phui-tag-icon-view"><span class="phui-tag-core"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check-square-o" data-meta="0_203"></span>Closed</span></span><span class="policy-header-callout"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-globe bluegrey" data-meta="0_202"></span><a class="policy-link" data-sigil="workflow" href="/policy/explain/PHID-DREV-hncji3lc7sulkza3cuab/view/">Public</a></span></div></div><div class="phui-header-col3"></div></div></h1></div></div><div class="phui-two-column-subheader"><div class="phui-head-thing-view phui-head-has-image head-thing-small"><a aria-hidden="true" class="visual-only phui-head-thing-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a>Authored by <strong><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a></strong> on Apr 19 2019, 11:58 AM.</div></div><div class="phui-two-column-content"><div class="phui-two-column-row grouped"><div class="phui-side-column"><div class=""><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-two-column-properties"><ul class="phabricator-action-list-view" id="UQ0_0"><li class="phabricator-action-view phabricator-action-view-href action-has-icon" id="UQ0_49" style=""><a class="phabricator-action-view-item" href="/D60912?large=true&amp;id=&amp;download=true"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-download phabricator-action-view-icon" data-meta="0_146"></span>Download Raw Diff</a></li></ul></div></div></div><div class="phui-main-column"><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Details</span></div><div class="phui-header-col3"></div></div></h1></div><div class="phui-property-list-section"><div class="phui-property-list-container grouped"><div class="phui-property-list-properties-wrap"><dl class="phui-property-list-properties"><dt class="phui-property-list-key">Reviewers </dt><dd class="phui-property-list-value"><table class="phui-status-list-view"><tbody><tr class=""><td class="phui-status-item-target"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check-circle green" data-meta="0_13" data-sigil="has-tooltip"></span><a class="phui-handle phui-link-person" data-meta="0_9" data-sigil="hovercard" href="/p/rnk/">rnk</a></td><td class="phui-status-item-note"></td></tr><tr class=""><td class="phui-status-item-target"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-circle-o bluegrey" data-meta="0_14" data-sigil="has-tooltip"></span><a class="phui-handle phui-link-person" data-meta="0_10" data-sigil="hovercard" href="/p/majnemer/">majnemer</a></td><td class="phui-status-item-note"></td></tr><tr class=""><td class="phui-status-item-target"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-circle-o bluegrey" data-meta="0_15" data-sigil="has-tooltip"></span><a class="phui-handle phui-link-person" data-meta="0_11" data-sigil="hovercard" href="/p/erichkeane/">erichkeane</a></td><td class="phui-status-item-note"></td></tr><tr class=""><td class="phui-status-item-target"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-circle-o bluegrey" data-meta="0_16" data-sigil="has-tooltip"></span><a class="phui-handle phui-link-person" data-meta="0_12" data-sigil="hovercard" href="/p/cfe-commits/">cfe-commits</a></td><td class="phui-status-item-note"></td></tr></tbody></table> </dd></dl></div></div><div class="phui-property-list-section-header"><span class="phui-property-list-section-header-icon"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-align-left bluegrey" data-meta="0_17"></span>Summary</span></div><div class="phui-property-list-text-content"><div class="phabricator-remarkup"><p>MS only run time problem with inline static data member or inline variable.<br/>
An inline static data member's initialize function or inline variable's initialize function gets called multiple time.</p>

<p>To fix this, using template static data member’s initialization method instead.<br/>
So that inline static data member or inline variable initialize's function can be put into COMDAT group with global being initialized.  And also put inline data in the linker directive.  So that the function can be called before main.</p>

<p>The bug is report in:<br/>
<a class="remarkup-link" href="https://bugs.llvm.org/show_bug.cgi?id=37903" rel="nofollow" target="_blank">https://bugs.llvm.org/show_bug.cgi?id=37903</a></p></div></div></div></div><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Diff Detail</span></div><div class="phui-header-col3"></div></div></h1></div><div class="" data-meta="0_18" data-sigil="phui-tab-group-view"><div id="UQ0_10"><div class=""><div class="phui-property-list-section"></div></div></div></div></div><div class="phui-timeline-view" id="UQ0_11"><h3 class="aural-only">Event Timeline</h3><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_47" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-minor-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><a class="phabricator-anchor-view" id="1472902" name="1472902"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_46"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> created this revision.<span class="phui-timeline-extra"><a data-meta="0_45" data-sigil="has-tooltip" href="#1472902">Apr 19 2019, 11:58 AM</a></span></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_50" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-minor-event"><div class="phui-timeline-content"><div class="phui-timeline-wedge" style="display: none;"></div><div class="phui-timeline-group"><a class="phabricator-anchor-view" id="1472911" name="1472911"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-link phui-timeline-icon" data-meta="0_49"></span></span><a class="phui-handle" href="/herald/">Herald</a> added a project: <span class="phui-handle"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-lock lightgreytext" data-meta="0_30"></span>Restricted Project</span>. <span class="phui-timeline-extra-information"> ·  <a href="/herald/transcript/480591/">View Herald Transcript</a></span><span class="phui-timeline-extra"><a data-meta="0_48" data-sigil="has-tooltip" href="#1472911">Apr 19 2019, 11:58 AM</a></span></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_61" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rnk/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1472983" name="1472983"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_58"></span></span><a class="phui-handle phui-link-person" href="/p/rnk/">rnk</a> added a comment.<span class="phui-timeline-extra"><a data-meta="0_57" data-sigil="has-tooltip" href="#1472983">Apr 19 2019, 1:01 PM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_55" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_56"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_31" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>Thanks, I think there's another case to handle, though.</p></div></span><table class="phabricator-inline-summary-table"><tbody><tr><th class="inline-comment-summary-table-header" colspan="3"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-code-o darkbluetext mmr" data-meta="0_59"></span>lib/CodeGen/CGDeclCXX.cpp</th></tr>
<tr><td class="inline-line-number inline-table-dolumn"><a class="num" href="#inline-539985"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-share darkbluetext mmr" data-meta="0_60"></span>471–473</a></td><td class="inline-summary-content inline-table-dolumn" colspan="2"><div class="phabricator-remarkup"><span class="transaction-comment" data-meta="0_32" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>I think the whole second condition can be simplified to just <tt class="remarkup-monospaced">D-&gt;isIinlineSpecified()</tt>. We have to consider plain inline global variables, not just static data members, as in:</p>

<div class="remarkup-code-block" data-code-lang="text" data-sigil="remarkup-code-block"><pre class="remarkup-code">int f();
inline int gvinit_inline = f();
int useit() { return gvinit_inline ; }</pre></div></div></span></div></td></tr></tbody></table></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_70" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1472986" name="1472986"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_69"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> added a comment.<span class="phui-timeline-extra"><a data-meta="0_68" data-sigil="has-tooltip" href="#1472986">Apr 19 2019, 1:15 PM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_66" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_67"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_33" data-sigil="transaction-comment"><div class="phabricator-remarkup"><blockquote class="remarkup-reply-block">
<div class="remarkup-reply-head">In <a class="phui-tag-view phui-tag-type-object" data-meta="0_19" data-sigil="hovercard" href="/D60912#1472983"><span class="phui-tag-core-closed"><span class="phui-tag-core phui-tag-color-object">D60912#1472983</span></span></a>, <a class="phui-tag-view phui-tag-type-person" data-meta="0_20" data-sigil="hovercard" href="/p/rnk/"><span class="phui-tag-core phui-tag-color-person">@rnk</span></a> wrote:</div>
<div class="remarkup-reply-body"><p>Thanks, I think there's another case to handle, though.</p></div>
</blockquote>

<p>Hi Reid,<br/>
Thank you so much for the review.</p>

<p>Yes, I check the following test case, both gnu and cl call foo twice.  Do we want to do differently with that?  Thanks.  Jennifer<br/>
I add MS only, since we are generate same with gnu.  Sure remove that should work at run time.  But I am not sure if we have abi issues when mix-match object.  I will look more about that.    Thanks.</p>

<p>bug-37903&gt;g++ x.cpp x1.cpp -std=c++17<br/>
bug-37903&gt;./a.out<br/>
foo<br/>
foo</p>

<p>bug-37903&gt;cat x.h<br/>
extern "C" int printf(const char*,...);<br/>
int foo();<br/>
inline static int aoo = foo(); // C++17 inline variable, thus also a definition<br/>
bug-37903&gt;cat x.cpp<br/>
#include "x.h"<br/>
int foo()<br/>
{</p>

<div class="remarkup-code-block" data-code-lang="text" data-sigil="remarkup-code-block"><pre class="remarkup-code">printf("foo\n");
return 1;</pre></div>

<p>}<br/>
int main()<br/>
{<br/>
}<br/>
bug-37903&gt;cat x1.cpp<br/>
#include "x.h"</p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_79" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rnk/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1472987" name="1472987"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_78"></span></span><a class="phui-handle phui-link-person" href="/p/rnk/">rnk</a> added a comment.<span class="phui-timeline-extra"><a data-meta="0_77" data-sigil="has-tooltip" href="#1472987">Apr 19 2019, 1:19 PM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_75" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_76"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_34" data-sigil="transaction-comment"><div class="phabricator-remarkup"><blockquote class="remarkup-reply-block">
<div class="remarkup-reply-head">In <a class="phui-tag-view phui-tag-type-object" data-meta="0_21" data-sigil="hovercard" href="/D60912#1472986"><span class="phui-tag-core-closed"><span class="phui-tag-core phui-tag-color-object">D60912#1472986</span></span></a>, <a class="phui-tag-view phui-tag-type-person" data-meta="0_22" data-sigil="hovercard" href="/p/jyu2/"><span class="phui-tag-core phui-tag-color-person">@jyu2</span></a> wrote:</div>
<div class="remarkup-reply-body"><p>inline static int aoo = foo(); // C++17 inline variable, thus also a definition</p></div>
</blockquote>

<p>This is a <tt class="remarkup-monospaced">static inline</tt> global variable, so it technically creates two different globals, so calling foo twice is intended behavior. I think we really want to look at the GVA linkage instead of trying to list all the reasons why something might have weak linkage. Take a look at <tt class="remarkup-monospaced">shouldBeInCOMDAT</tt> in CodeGenModule.cpp, I think it has the logic we want.</p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_88" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1473036" name="1473036"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_87"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> added a comment.<span class="phui-timeline-extra"><a data-meta="0_86" data-sigil="has-tooltip" href="#1473036">Apr 19 2019, 1:51 PM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_84" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_85"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_35" data-sigil="transaction-comment"><div class="phabricator-remarkup"><blockquote class="remarkup-reply-block">
<div class="remarkup-reply-head">In <a class="phui-tag-view phui-tag-type-object" data-meta="0_24" data-sigil="hovercard" href="/D60912#1472987"><span class="phui-tag-core-closed"><span class="phui-tag-core phui-tag-color-object">D60912#1472987</span></span></a>, <a class="phui-tag-view phui-tag-type-person" data-meta="0_26" data-sigil="hovercard" href="/p/rnk/"><span class="phui-tag-core phui-tag-color-person">@rnk</span></a> wrote:</div>
<div class="remarkup-reply-body"><blockquote class="remarkup-reply-block">
<div class="remarkup-reply-head">In <a class="phui-tag-view phui-tag-type-object" data-meta="0_23" data-sigil="hovercard" href="/D60912#1472986"><span class="phui-tag-core-closed"><span class="phui-tag-core phui-tag-color-object">D60912#1472986</span></span></a>, <a class="phui-tag-view phui-tag-type-person" data-meta="0_25" data-sigil="hovercard" href="/p/jyu2/"><span class="phui-tag-core phui-tag-color-person">@jyu2</span></a> wrote:</div>
<div class="remarkup-reply-body"><p>inline static int aoo = foo(); // C++17 inline variable, thus also a definition</p></div>
</blockquote>

<p>This is a <tt class="remarkup-monospaced">static inline</tt> global variable, so it technically creates two different globals, so calling foo twice is intended behavior. I think we really want to look at the GVA linkage instead of trying to list all the reasons why something might have weak linkage. Take a look at <tt class="remarkup-monospaced">shouldBeInCOMDAT</tt> in CodeGenModule.cpp, I think it has the logic we want.</p></div>
</blockquote>

<p>Yes, that is good.  I will do that way.  Thanks.  <br/>
Jennifer</p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-sky" data-meta="0_99" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1476354" name="1476354"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-sky"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-refresh phui-timeline-icon" data-meta="0_96"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> updated this revision to <a class="phui-handle" href="/differential/diff/196346/">Diff 196346</a>.<span class="phui-timeline-extra"><a data-meta="0_95" data-sigil="has-tooltip" href="#1476354">Apr 23 2019, 3:52 PM</a></span></div><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_97"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> retitled this revision from <span class="phui-timeline-value">MS ABI: handle inline static data member as template static data member</span> to <span class="phui-timeline-value">MS ABI: handle inline static data member and inline variable as template static data member</span>.</div><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_98"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> edited the summary of this revision. <a data-sigil="workflow" href="/transactions/detail/PHID-XACT-DREV-fi343bfdcmwvpo5/">(Show Details)</a></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_93" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_94"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_36" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>Hi Reid,<br/>
Thanks for your review and catch what I were missing for inline variable part(only inline static data member were fix in previous patch). <br/>
As you suggested, instead using GVA_DiscardableODR to put inline variable's initialization function or inline static member's initialization functions into to COMDAT group with global being initialized.</p>

<p>The  GVA_DiscardableODR is for weak linkage of inline variables.</p>

<p>Let me know if you see problems.<br/>
Thank you so much!<br/>
Thanks.</p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-green" data-meta="0_110" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rnk/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1476373" name="1476373"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-green"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check-circle-o phui-timeline-icon" data-meta="0_107"></span></span><a class="phui-handle phui-link-person" href="/p/rnk/">rnk</a> accepted this revision.<span class="phui-timeline-extra"><a data-meta="0_106" data-sigil="has-tooltip" href="#1476373">Apr 23 2019, 4:16 PM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_104" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_105"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_37" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>lgtm</p></div></span><table class="phabricator-inline-summary-table"><tbody><tr><th class="inline-comment-summary-table-header" colspan="3"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-code-o darkbluetext mmr" data-meta="0_108"></span>lib/CodeGen/CGDeclCXX.cpp</th></tr>
<tr><td class="inline-line-number inline-table-dolumn"><a class="num" href="#inline-541006"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-share darkbluetext mmr" data-meta="0_109"></span>470–471</a></td><td class="inline-summary-content inline-table-dolumn" colspan="2"><div class="phabricator-remarkup"><span class="transaction-comment" data-meta="0_38" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>I think this can be simplified by removing the <tt class="remarkup-monospaced">isTemplateInstantiation</tt> check and then checking for GVA_DiscardableODR or GVA_StrongODR. That will handle the cases of explicit template instantiation that you have below.</p>

<p>It's up to you if you want to implement the simplification. The current code is correct, I don't believe it's possible to create a GVA_StrongODR global variable with a dynamic initializer without template instantiation (phew).</p></div></span></div></td></tr></tbody></table></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-green" data-meta="0_113" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-minor-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rnk/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><a class="phabricator-anchor-view" id="1476376" name="1476376"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-green"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check phui-timeline-icon" data-meta="0_112"></span></span>This revision is now accepted and ready to land.<span class="phui-timeline-extra"><a data-meta="0_111" data-sigil="has-tooltip" href="#1476376">Apr 23 2019, 4:16 PM</a></span></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_122" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rnk/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1479008" name="1479008"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-user-plus phui-timeline-icon" data-meta="0_121"></span></span><a class="phui-handle phui-link-person" href="/p/rnk/">rnk</a> added a subscriber: <a class="phui-handle phui-link-person" data-meta="0_39" data-sigil="hovercard" href="/p/hans/">hans</a>.<span class="phui-timeline-extra"><a data-meta="0_120" data-sigil="has-tooltip" href="#1479008">Apr 25 2019, 10:17 AM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_118" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_119"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_40" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>+<a class="phui-tag-view phui-tag-type-person" data-meta="0_27" data-sigil="hovercard" href="/p/hans/"><span class="phui-tag-core phui-tag-color-person">@hans</span></a>, per <a class="remarkup-link" href="https://bugs.llvm.org/show_bug.cgi?id=37903#c16" rel="nofollow" target="_blank">https://bugs.llvm.org/show_bug.cgi?id=37903#c16</a></p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_128" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1479071" name="1479071"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_124"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> marked an inline comment as done.<span class="phui-timeline-extra"><a data-meta="0_123" data-sigil="has-tooltip" href="#1479071">Apr 25 2019, 10:47 AM</a></span></div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_125"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> added inline comments.</div><div class="phui-timeline-core-content"><table class="phabricator-inline-summary-table"><tbody><tr><th class="inline-comment-summary-table-header" colspan="3"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-code-o darkbluetext mmr" data-meta="0_126"></span>lib/CodeGen/CGDeclCXX.cpp</th></tr>
<tr><td class="inline-line-number inline-table-dolumn"><a class="num" href="#inline-541923"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-share darkbluetext mmr" data-meta="0_127"></span>470–471</a></td><td class="inline-summary-content inline-table-dolumn" colspan="2"><div class="phabricator-remarkup"><span class="transaction-comment" data-meta="0_41" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>Thanks Reid!  I also think GVA_StrongODR which is set for template instantiation, but I am not too sure about it.  Since we already handle template by calling isTemplateInstantiation, and add GVA_DiscardableODR.  I'd like to with this.  If we see other problem.  We can always add it up.</p>

<p>Thank you so much for your review.</p></div></span></div></td></tr></tbody></table></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-indigo" data-meta="0_137" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/jyu2/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="1479074" name="1479074"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-indigo"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check phui-timeline-icon" data-meta="0_136"></span></span><a class="phui-handle phui-link-person" href="/p/jyu2/">jyu2</a> closed this revision.<span class="phui-timeline-extra"><a data-meta="0_135" data-sigil="has-tooltip" href="#1479074">Apr 25 2019, 10:48 AM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_133" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_134"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_42" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>committed <a class="phui-tag-view phui-tag-type-object" data-meta="0_28" data-sigil="hovercard" href="/rGc19f4f8069722f6804086d4438a0254104242c46"><span class="phui-tag-core phui-tag-color-object">rGc19f4f806972</span></a>: Fix bug 37903:MS ABI: handle inline static data member and inline variable as… (authored by jyu2).</p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell" data-meta="0_143" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/MaskRay/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="2909029" name="2909029"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-user-plus phui-timeline-icon" data-meta="0_139"></span></span><a class="phui-handle phui-link-person" href="/p/MaskRay/">MaskRay</a> added a subscriber: <a class="phui-handle phui-link-person" data-meta="0_43" data-sigil="hovercard" href="/p/MaskRay/">MaskRay</a>.<span class="phui-timeline-extra"><a data-meta="0_138" data-sigil="has-tooltip" href="#2909029">Jul 27 2021, 5:08 PM</a></span></div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_140"></span></span><a class="phui-handle phui-link-person" href="/p/MaskRay/">MaskRay</a> added inline comments.</div><div class="phui-timeline-core-content"><table class="phabricator-inline-summary-table"><tbody><tr><th class="inline-comment-summary-table-header" colspan="3"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-code-o darkbluetext mmr" data-meta="0_141"></span>lib/CodeGen/CGDeclCXX.cpp</th></tr>
<tr><td class="inline-line-number inline-table-dolumn"><a class="num" href="#inline-1018106"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-share darkbluetext mmr" data-meta="0_142"></span>494</a></td><td class="inline-summary-content inline-table-dolumn" colspan="2"><div class="phabricator-remarkup"><span class="transaction-comment" data-meta="0_44" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>Confirmed with <tt class="remarkup-monospaced">lld-link -subsystem:console -opt:ref -debug:symtab a.o b.o c.o -entry:main -out:win.exe</tt> that <tt class="remarkup-monospaced">__declspec(selectany)</tt> can be linker GCed.</p>

<p>Sent <a class="phui-tag-view phui-tag-type-object" data-meta="0_29" data-sigil="hovercard" href="/D106925"><span class="phui-tag-core-closed"><span class="phui-tag-core phui-tag-color-object">D106925</span></span></a> to fix it.</p></div></span></div></td></tr></tbody></table></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div></div></div></div></div><div class="phui-two-column-content phui-two-column-footer"><legend class="phabricator-anchor-navigation-marker" data-meta="0_160" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="toc" name="toc"></a><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Revision Contents</span></div><div class="phui-header-col3"></div></div></h1></div><div class="" data-meta="0_179" data-sigil="phui-tab-group-view"><ul class="phui-list-view phui-list-navbar phui-list-navbar-horizontal"><li class="phui-list-item-view phui-list-item-type-link phui-list-item-selected" data-meta="0_180" data-sigil="phui-tab-view"><a class="phui-list-item-href" data-sigil="" href="#"><span class="phui-list-item-name">Files</span></a></li><li class="phui-list-item-view phui-list-item-type-link" data-meta="0_181" data-sigil="phui-tab-view"><a class="phui-list-item-href" data-sigil="" href="#"><span class="phui-list-item-name">History</span></a></li><li class="phui-list-item-view phui-list-item-type-link" data-meta="0_182" data-sigil="phui-tab-view"><a class="phui-list-item-href" data-sigil="" href="#"><span class="phui-list-item-name">Commits</span></a></li></ul><div id="UQ0_68"><div class=""><div class="aphront-table-wrap"><table class="aphront-table-view aphront-table-view-compact"><tbody><tr><th class="diff-toc-path wide">Path</th><th class="right aphront-table-view-nodevice">Size</th></tr><tr class="diff-toc-no-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 0px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-folder-open-o grey" data-meta="0_163"></span></td><td><div class="">lib/</div></td><td><div class="">CodeGen/</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice"></td></tr><tr class="alt alt-diff-toc-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 16px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o bluetext" data-meta="0_165"></span></td><td><div class=""><a data-meta="0_166" data-sigil="differential-load" href="#change-5K4eV4tdqMqW">CGDeclCXX.cpp</a></div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice">8 lines</td></tr><tr class="diff-toc-no-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 0px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-folder-open-o grey" data-meta="0_168"></span></td><td><div class="">test/</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice"></td></tr><tr class="alt alt-diff-toc-no-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 16px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-folder-open-o grey" data-meta="0_170"></span></td><td><div class="">CodeGenCXX/</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice"></td></tr><tr class="diff-toc-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 32px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-plus create-color" data-meta="0_172"></span></td><td><div class=""><a data-meta="0_173" data-sigil="differential-load" href="#change-8FNeP00duYz7">microsoft-abi-template-static-init.cpp</a></div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice">92 lines</td></tr><tr class="alt alt-diff-toc-no-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 16px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-folder-open-o grey" data-meta="0_175"></span></td><td><div class="">Modules/</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice"></td></tr><tr class="diff-toc-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 32px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o bluetext" data-meta="0_177"></span></td><td><div class=""><a data-meta="0_178" data-sigil="differential-load" href="#change-YYFydCIQ4H5D">initializers.cpp</a></div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice">1 line</td></tr></tbody></table></div></div></div><div id="UQ0_69" style="display: none;"><div class=""><form action="/D60912#toc"><div class="aphront-table-wrap"><table class="aphront-table-view"><tbody><tr><th class="pri">Diff</th><th>ID</th><th class="aphront-table-view-nodevice">Base</th><th class="wide">Description</th><th class="date aphront-table-view-nodevice">Created</th><th class="center aphront-table-view-nodevice">Lint</th><th class="center aphront-table-view-nodevice">Unit</th><th class="center differential-update-history-old"></th><th class="center differential-update-history-new"></th></tr><tr class="differential-update-history-old-now"><td class="pri">Base</td><td><a href="/D60912?id="></a></td><td class="aphront-table-view-nodevice"></td><td class="wide">Base</td><td class="date aphront-table-view-nodevice"></td><td class="center aphront-table-view-nodevice"></td><td class="center aphront-table-view-nodevice"></td><td class="center differential-update-history-old"><div class="differential-update-history-radio"><input checked="checked" id="UQ0_71" name="vs" type="radio"/></div></td><td class="center differential-update-history-new"></td></tr><tr class="alt"><td class="pri">Diff 1</td><td><a href="/D60912?id=195892">195892</a></td><td class="aphront-table-view-nodevice"></td><td class="wide"></td><td class="date aphront-table-view-nodevice">Apr 19 2019, 11:41 AM</td><td class="center aphront-table-view-nodevice"><div class="lintunit-star" title="Lint Skipped"><span class="diff-star-skip">★</span></div></td><td class="center aphront-table-view-nodevice"><div class="lintunit-star" title="Unit Tests Skipped"><span class="diff-star-skip">★</span></div></td><td class="center differential-update-history-old"><div class="differential-update-history-radio"><input id="UQ0_72" name="vs" type="radio" value="195892"/></div></td><td class="center differential-update-history-new"><div class="differential-update-history-radio"><input data-sigil="differential-new-radio" name="id" type="radio" value="195892"/></div></td></tr><tr class="differential-update-history-new-now"><td class="pri">Diff 2</td><td><a href="/D60912?id=196346">196346</a></td><td class="aphront-table-view-nodevice"></td><td class="wide"></td><td class="date aphront-table-view-nodevice">Apr 23 2019, 3:28 PM</td><td class="center aphront-table-view-nodevice"><div class="lintunit-star" title="Lint Skipped"><span class="diff-star-skip">★</span></div></td><td class="center aphront-table-view-nodevice"><div class="lintunit-star" title="Unit Tests Skipped"><span class="diff-star-skip">★</span></div></td><td class="center differential-update-history-old"></td><td class="center differential-update-history-new"><div class="differential-update-history-radio"><input checked="checked" data-sigil="differential-new-radio" name="id" type="radio" value="196346"/></div></td></tr></tbody></table></div></form></div></div><div id="UQ0_70" style="display: none;"><div class=""></div></div></div></div><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-object-box-collapsed phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Diff 196346</span></div><div class="phui-header-col3"></div></div></h1></div><div class="differential-review-stage" id="differential-review-stage"><div class="differential-changeset" data-autoid="autoid_5" data-meta="0_187" data-sigil="differential-changeset" id="diff-change-5K4eV4tdqMqW"><legend class="phabricator-anchor-navigation-marker" data-meta="0_185" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="change-5K4eV4tdqMqW" name="change-5K4eV4tdqMqW"></a><h1 class="differential-file-icon-header" data-sigil="changeset-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o" data-meta="0_186"></span><span class="differential-changeset-path-name" data-sigil="changeset-header-path-name">lib/CodeGen/CGDeclCXX.cpp</span></h1><div class="changeset-view-content" data-sigil="changeset-view-content"><table class="differential-diff remarkup-code PhabricatorMonospaced diff-2up" data-sigil="differential-diff intercept-copy"><colgroup><col class="num"/><col class="left"/><col class="num"/><col class="copy"/><col class="right"/><col class="cov"/></colgroup><tbody><tr data-sigil="context-target"><td class="show-context-line n left-context"></td><td class="show-more"><a data-meta="2_1" data-mustcapture="1" data-sigil="show-more" href="#">Show First 20 Lines</a> • <a data-meta="2_2" data-mustcapture="1" data-sigil="show-more" href="#">Show All 461 Lines</a> • <a data-meta="2_3" data-mustcapture="1" data-sigil="show-more" href="#">▼ Show 20 Lines</a></td><td class="show-context-line n" data-n="459"></td><td class="show-context" colspan="3">  <span class="k">if</span> <span class="p">(</span><span class="n">D</span><span class="o">-&gt;</span><span class="n">getTLSKind</span><span class="p">())</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="462" id="C1428259OL462"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// entire TU.</span>
</td><td class="n" data-n="462" id="C1428259NL462"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// entire TU.</span>
</td></tr><tr><td class="n" data-n="463" id="C1428259OL463"></td><td class="" data-copy-mode="copy-l">    <span class="n">CXXThreadLocalInits</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Fn</span><span class="p">);</span>
</td><td class="n" data-n="463" id="C1428259NL463"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">CXXThreadLocalInits</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Fn</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="464" id="C1428259OL464"></td><td class="" data-copy-mode="copy-l">    <span class="n">CXXThreadLocalInitVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">D</span><span class="p">);</span>
</td><td class="n" data-n="464" id="C1428259NL464"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">CXXThreadLocalInitVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">D</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="465" id="C1428259OL465"></td><td class="" data-copy-mode="copy-l">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">PerformInit</span> <span class="o">&amp;&amp;</span> <span class="n">ISA</span><span class="p">)</span> <span class="p">{</span>
</td><td class="n" data-n="465" id="C1428259NL465"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">PerformInit</span> <span class="o">&amp;&amp;</span> <span class="n">ISA</span><span class="p">)</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="466" id="C1428259OL466"></td><td class="" data-copy-mode="copy-l">    <span class="n">EmitPointerToInitFunc</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">Fn</span><span class="p">,</span> <span class="n">ISA</span><span class="p">);</span>
</td><td class="n" data-n="466" id="C1428259NL466"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">EmitPointerToInitFunc</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">Fn</span><span class="p">,</span> <span class="n">ISA</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="467" id="C1428259OL467"></td><td class="" data-copy-mode="copy-l">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="o">*</span><span class="n">IPA</span> <span class="o">=</span> <span class="n">D</span><span class="o">-&gt;</span><span class="n">getAttr</span><span class="o">&lt;</span><span class="n">InitPriorityAttr</span><span class="o">&gt;</span><span class="p">())</span> <span class="p">{</span>
</td><td class="n" data-n="467" id="C1428259NL467"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="o">*</span><span class="n">IPA</span> <span class="o">=</span> <span class="n">D</span><span class="o">-&gt;</span><span class="n">getAttr</span><span class="o">&lt;</span><span class="n">InitPriorityAttr</span><span class="o">&gt;</span><span class="p">())</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="468" id="C1428259OL468"></td><td class="" data-copy-mode="copy-l">    <span class="n">OrderGlobalInits</span> <span class="n">Key</span><span class="p">(</span><span class="n">IPA</span><span class="o">-&gt;</span><span class="n">getPriority</span><span class="p">(),</span> <span class="n">PrioritizedCXXGlobalInits</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</td><td class="n" data-n="468" id="C1428259NL468"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">OrderGlobalInits</span> <span class="n">Key</span><span class="p">(</span><span class="n">IPA</span><span class="o">-&gt;</span><span class="n">getPriority</span><span class="p">(),</span> <span class="n">PrioritizedCXXGlobalInits</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</td></tr><tr><td class="n" data-n="469" id="C1428259OL469"></td><td class="" data-copy-mode="copy-l">    <span class="n">PrioritizedCXXGlobalInits</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span> <span class="n">Fn</span><span class="p">));</span>
</td><td class="n" data-n="469" id="C1428259NL469"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">PrioritizedCXXGlobalInits</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span> <span class="n">Fn</span><span class="p">));</span>
</td></tr><tr><td class="old n" data-n="470" id="C1428259OL470"></td><td class="old" data-copy-mode="copy-l">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isTemplateInstantiation</span><span class="p">(</span><span class="n">D</span><span class="o">-&gt;</span><span class="n">getTemplateSpecializationKind</span><span class="p">())<span class="bright">)</span></span><span class="bright"> </span><span class="p"><span class="bright">{</span></span>
</td><td class="new n" data-n="470" id="C1428259NL470"></td><td class="copy"></td><td class="new" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isTemplateInstantiation</span><span class="p">(</span><span class="n">D</span><span class="o">-&gt;</span><span class="n">getTemplateSpecializationKind</span><span class="p">())<span class="bright"></span></span><span class="bright"> </span><span class="o"><span class="bright">||</span></span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="471" id="C1428259NL471"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">             <span class="n">getContext</span><span class="p">().</span><span class="n">GetGVALinkageForVariable</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="n">GVA_DiscardableODR</span><span class="p">)</span> <span class="p">{</span>
</td></tr><tr class="inline" data-meta="2_11" data-sigil="inline-row"><td class="n"></td><td class="left"></td><td class="n"><a class="reveal-inline" data-mustcapture="1" data-sigil="reveal-inline" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment" data-meta="2_7" data-sigil="has-tooltip"></span></a></td><td class="copy"></td><td colspan="2" id="anchor-inline-541006"><a class="differential-inline-comment-anchor" id="inline-541006" name="inline-541006"></a><div class="differential-inline-comment inline-comment-element" data-meta="2_10" data-sigil="differential-inline-comment"><div class="differential-inline-comment-head grouped" data-sigil="differential-inline-header"><div class="inline-head-left">rnk<span class="phui-tag-view phui-tag-type-shade phui-tag-red phui-tag-slim phui-tag-shade mml inline-draft-text"><span class="phui-tag-core">Unsubmitted</span></span></div><div class="inline-head-right"><div class="done-label button-not-done">Not Done</div><span class="phui-button-bar phui-button-bar-borderless inline-button-divider"><a class="button has-icon phui-button-default phui-button-bar-first" data-meta="2_8" data-mustcapture="1" data-sigil="has-tooltip differential-inline-reply" role="button"><span class="aural-only">Reply</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-reply" data-meta="2_9"></span></a><a class="button button-grey dropdown icon-last phui-button-default phui-button-bar-last" data-sigil="inline-action-dropdown" role="button"><span class="aural-only">Inline Actions</span><span class="caret"></span></a></span></div></div><div class="differential-inline-comment-content"><div class="phabricator-remarkup"><p>I think this can be simplified by removing the <tt class="remarkup-monospaced">isTemplateInstantiation</tt> check and then checking for GVA_DiscardableODR or GVA_StrongODR. That will handle the cases of explicit template instantiation that you have below.</p>

<p>It's up to you if you want to implement the simplification. The current code is correct, I don't believe it's possible to create a GVA_StrongODR global variable with a dynamic initializer without template instantiation (phew).</p></div></div></div><div class="differential-inline-summary"><strong>rnk:</strong> I think this can be simplified by removing the `isTemplateInstantiation` check and then…</div></td></tr><tr class="inline" data-meta="2_17" data-sigil="inline-row"><td class="n"></td><td class="left"></td><td class="n"><a class="reveal-inline" data-mustcapture="1" data-sigil="reveal-inline" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment" data-meta="2_12" data-sigil="has-tooltip"></span></a></td><td class="copy"></td><td colspan="2" id="anchor-inline-541923"><a class="differential-inline-comment-anchor" id="inline-541923" name="inline-541923"></a><div class="differential-inline-comment inline-comment-element inline-comment-is-reply inline-is-done" data-meta="2_16" data-sigil="differential-inline-comment"><div class="differential-inline-comment-head grouped" data-sigil="differential-inline-header"><div class="inline-head-left">jyu2<span class="phui-tag-view phui-tag-type-shade phui-tag-yellow phui-tag-slim phui-tag-shade mml"><span class="phui-tag-core">Author</span></span><span class="phui-tag-view phui-tag-type-shade phui-tag-red phui-tag-slim phui-tag-shade mml inline-draft-text"><span class="phui-tag-core">Unsubmitted</span></span></div><div class="inline-head-right"><div class="done-label button-done"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check sky msr" data-meta="2_13"></span>Done</div><span class="phui-button-bar phui-button-bar-borderless inline-button-divider"><a class="button has-icon phui-button-default phui-button-bar-first" data-meta="2_14" data-mustcapture="1" data-sigil="has-tooltip differential-inline-reply" role="button"><span class="aural-only">Reply</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-reply" data-meta="2_15"></span></a><a class="button button-grey dropdown icon-last phui-button-default phui-button-bar-last" data-sigil="inline-action-dropdown" role="button"><span class="aural-only">Inline Actions</span><span class="caret"></span></a></span></div></div><div class="differential-inline-comment-content"><div class="phabricator-remarkup"><p>Thanks Reid!  I also think GVA_StrongODR which is set for template instantiation, but I am not too sure about it.  Since we already handle template by calling isTemplateInstantiation, and add GVA_DiscardableODR.  I'd like to with this.  If we see other problem.  We can always add it up.</p>

<p>Thank you so much for your review.</p></div></div></div><div class="differential-inline-summary"><strong>jyu2:</strong> Thanks Reid!  I also think GVA_StrongODR which is set for template instantiation, but I am not…</div></td></tr><tr><td class="n" data-n="471" id="C1428259OL471"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// C++ [basic.start.init]p2:</span>
</td><td class="n" data-n="472" id="C1428259NL472"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// C++ [basic.start.init]p2:</span>
</td></tr><tr><td class="n" data-n="472" id="C1428259OL472"></td><td class="" data-copy-mode="copy-l">    <span class="c1">//   Definitions of explicitly specialized class template static data</span>
</td><td class="n" data-n="473" id="C1428259NL473"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">//   Definitions of explicitly specialized class template static data</span>
</td></tr><tr class="inline" data-meta="2_23" data-sigil="inline-row"><td class="n"></td><td class="left"></td><td class="n"><a class="reveal-inline" data-mustcapture="1" data-sigil="reveal-inline" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment" data-meta="2_18" data-sigil="has-tooltip"></span></a></td><td class="copy"></td><td colspan="2" id="anchor-inline-539985"><a class="differential-inline-comment-anchor" id="inline-539985" name="inline-539985"></a><div class="differential-inline-comment inline-comment-element inline-comment-ghost" data-meta="2_22" data-sigil="differential-inline-comment"><div class="differential-inline-comment-head grouped" data-sigil="differential-inline-header"><div class="inline-head-left">rnk<span class="phui-tag-view phui-tag-type-shade phui-tag-red phui-tag-slim phui-tag-shade mml inline-draft-text"><span class="phui-tag-core">Unsubmitted</span></span><a class="ghost-icon" href="/D60912?id=195892#inline-539985" target="_blank"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-fast-backward" data-meta="2_19" data-sigil="has-tooltip"></span></a></div><div class="inline-head-right"><div class="done-label button-not-done">Not Done</div><span class="phui-button-bar phui-button-bar-borderless inline-button-divider"><a class="button has-icon phui-button-default phui-button-bar-first" data-meta="2_20" data-mustcapture="1" data-sigil="has-tooltip differential-inline-reply" role="button"><span class="aural-only">Reply</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-reply" data-meta="2_21"></span></a><a class="button button-grey dropdown icon-last phui-button-default phui-button-bar-last" data-sigil="inline-action-dropdown" role="button"><span class="aural-only">Inline Actions</span><span class="caret"></span></a></span></div></div><div class="differential-inline-comment-content"><div class="phabricator-remarkup"><p>I think the whole second condition can be simplified to just <tt class="remarkup-monospaced">D-&gt;isIinlineSpecified()</tt>. We have to consider plain inline global variables, not just static data members, as in:</p>

<div class="remarkup-code-block" data-code-lang="text" data-sigil="remarkup-code-block"><pre class="remarkup-code">int f();
inline int gvinit_inline = f();
int useit() { return gvinit_inline ; }</pre></div></div></div></div><div class="differential-inline-summary"><strong>rnk:</strong> I think the whole second condition can be simplified to just `D-&gt;isIinlineSpecified()`. We have…</div></td></tr><tr><td class="n" data-n="473" id="C1428259OL473"></td><td class="" data-copy-mode="copy-l">    <span class="c1">//   members have ordered initialization. Other class template static data</span>
</td><td class="n" data-n="474" id="C1428259NL474"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">//   members have ordered initialization. Other class template static data</span>
</td></tr><tr><td class="n" data-n="474" id="C1428259OL474"></td><td class="" data-copy-mode="copy-l">    <span class="c1">//   members (i.e., implicitly or explicitly instantiated specializations)</span>
</td><td class="n" data-n="475" id="C1428259NL475"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">//   members (i.e., implicitly or explicitly instantiated specializations)</span>
</td></tr><tr><td class="n" data-n="475" id="C1428259OL475"></td><td class="" data-copy-mode="copy-l">    <span class="c1">//   have unordered initialization.</span>
</td><td class="n" data-n="476" id="C1428259NL476"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">//   have unordered initialization.</span>
</td></tr><tr><td class="n" data-n="476" id="C1428259OL476"></td><td class="" data-copy-mode="copy-l">    <span class="c1">//</span>
</td><td class="n" data-n="477" id="C1428259NL477"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">//</span>
</td></tr><tr><td class="n" data-n="477" id="C1428259OL477"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// As a consequence, we can put them into their own llvm.global_ctors entry.</span>
</td><td class="n" data-n="478" id="C1428259NL478"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// As a consequence, we can put them into their own llvm.global_ctors entry.</span>
</td></tr><tr><td class="n" data-n="478" id="C1428259OL478"></td><td class="" data-copy-mode="copy-l">    <span class="c1">//</span>
</td><td class="n" data-n="479" id="C1428259NL479"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">//</span>
</td></tr><tr><td class="n" data-n="479" id="C1428259OL479"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// If the global is externally visible, put the initializer into a COMDAT</span>
</td><td class="n" data-n="480" id="C1428259NL480"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// If the global is externally visible, put the initializer into a COMDAT</span>
</td></tr><tr><td class="n" data-n="480" id="C1428259OL480"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// group with the global being initialized.  On most platforms, this is a</span>
</td><td class="n" data-n="481" id="C1428259NL481"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// group with the global being initialized.  On most platforms, this is a</span>
</td></tr><tr><td class="n" data-n="481" id="C1428259OL481"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// minor startup time optimization.  In the MS C++ ABI, there are no guard</span>
</td><td class="n" data-n="482" id="C1428259NL482"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// minor startup time optimization.  In the MS C++ ABI, there are no guard</span>
</td></tr><tr><td class="n" data-n="482" id="C1428259OL482"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// variables, so this COMDAT key is required for correctness.</span>
</td><td class="n" data-n="483" id="C1428259NL483"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// variables, so this COMDAT key is required for correctness.</span>
</td></tr><tr><td class="n" data-n="483" id="C1428259OL483"></td><td class="" data-copy-mode="copy-l">    <span class="n">AddGlobalCtor</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span> <span class="mi">65535</span><span class="p">,</span> <span class="n">COMDATKey</span><span class="p">);</span>
</td><td class="n" data-n="484" id="C1428259NL484"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">AddGlobalCtor</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span> <span class="mi">65535</span><span class="p">,</span> <span class="n">COMDATKey</span><span class="p">);</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="485" id="C1428259NL485"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">    <span class="k">if</span> <span class="p">(</span><span class="n">getTarget</span><span class="p">().</span><span class="n">getCXXABI</span><span class="p">().</span><span class="n">isMicrosoft</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">COMDATKey</span><span class="p">)</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="486" id="C1428259NL486"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// In The MS C++, MS add template static data member in the linker</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="487" id="C1428259NL487"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// drective.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="488" id="C1428259NL488"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="n">addUsedGlobal</span><span class="p">(</span><span class="n">COMDATKey</span><span class="p">);</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="489" id="C1428259NL489"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">    <span class="p">}</span>
</td></tr><tr><td class="n" data-n="484" id="C1428259OL484"></td><td class="" data-copy-mode="copy-l">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">D</span><span class="o">-&gt;</span><span class="n">hasAttr</span><span class="o">&lt;</span><span class="n">SelectAnyAttr</span><span class="o">&gt;</span><span class="p">())</span> <span class="p">{</span>
</td><td class="n" data-n="490" id="C1428259NL490"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">D</span><span class="o">-&gt;</span><span class="n">hasAttr</span><span class="o">&lt;</span><span class="n">SelectAnyAttr</span><span class="o">&gt;</span><span class="p">())</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="485" id="C1428259OL485"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// SelectAny globals will be comdat-folded. Put the initializer into a</span>
</td><td class="n" data-n="491" id="C1428259NL491"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// SelectAny globals will be comdat-folded. Put the initializer into a</span>
</td></tr><tr><td class="n" data-n="486" id="C1428259OL486"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// COMDAT group associated with the global, so the initializers get folded</span>
</td><td class="n" data-n="492" id="C1428259NL492"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// COMDAT group associated with the global, so the initializers get folded</span>
</td></tr><tr><td class="n" data-n="487" id="C1428259OL487"></td><td class="" data-copy-mode="copy-l">    <span class="c1">// too.</span>
</td><td class="n" data-n="493" id="C1428259NL493"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="c1">// too.</span>
</td></tr><tr><td class="n" data-n="488" id="C1428259OL488"></td><td class="" data-copy-mode="copy-l">    <span class="n">AddGlobalCtor</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span> <span class="mi">65535</span><span class="p">,</span> <span class="n">COMDATKey</span><span class="p">);</span>
</td><td class="n" data-n="494" id="C1428259NL494"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">AddGlobalCtor</span><span class="p">(</span><span class="n">Fn</span><span class="p">,</span> <span class="mi">65535</span><span class="p">,</span> <span class="n">COMDATKey</span><span class="p">);</span>
</td></tr><tr class="inline" data-meta="2_28" data-sigil="inline-row"><td class="n"></td><td class="left"></td><td class="n"><a class="reveal-inline" data-mustcapture="1" data-sigil="reveal-inline" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment" data-meta="2_24" data-sigil="has-tooltip"></span></a></td><td class="copy"></td><td colspan="2" id="anchor-inline-1018106"><a class="differential-inline-comment-anchor" id="inline-1018106" name="inline-1018106"></a><div class="differential-inline-comment inline-comment-element" data-meta="2_27" data-sigil="differential-inline-comment"><div class="differential-inline-comment-head grouped" data-sigil="differential-inline-header"><div class="inline-head-left">MaskRay<span class="phui-tag-view phui-tag-type-shade phui-tag-red phui-tag-slim phui-tag-shade mml inline-draft-text"><span class="phui-tag-core">Unsubmitted</span></span></div><div class="inline-head-right"><div class="done-label button-not-done">Not Done</div><span class="phui-button-bar phui-button-bar-borderless inline-button-divider"><a class="button has-icon phui-button-default phui-button-bar-first" data-meta="2_25" data-mustcapture="1" data-sigil="has-tooltip differential-inline-reply" role="button"><span class="aural-only">Reply</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-reply" data-meta="2_26"></span></a><a class="button button-grey dropdown icon-last phui-button-default phui-button-bar-last" data-sigil="inline-action-dropdown" role="button"><span class="aural-only">Inline Actions</span><span class="caret"></span></a></span></div></div><div class="differential-inline-comment-content"><div class="phabricator-remarkup"><p>Confirmed with <tt class="remarkup-monospaced">lld-link -subsystem:console -opt:ref -debug:symtab a.o b.o c.o -entry:main -out:win.exe</tt> that <tt class="remarkup-monospaced">__declspec(selectany)</tt> can be linker GCed.</p>

<p>Sent <a class="phui-tag-view phui-tag-type-object" data-meta="2_0" data-sigil="hovercard" href="/D106925"><span class="phui-tag-core-closed"><span class="phui-tag-core phui-tag-color-object">D106925</span></span></a> to fix it.</p></div></div></div><div class="differential-inline-summary"><strong>MaskRay:</strong> Confirmed with `lld-link -subsystem:console -opt:ref -debug:symtab a.o b.o c.o -entry:main -out…</div></td></tr><tr><td class="n" data-n="489" id="C1428259OL489"></td><td class="" data-copy-mode="copy-l">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</td><td class="n" data-n="495" id="C1428259NL495"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="490" id="C1428259OL490"></td><td class="" data-copy-mode="copy-l">    <span class="n">I</span> <span class="o">=</span> <span class="n">DelayedCXXInitPosition</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">D</span><span class="p">);</span> <span class="c1">// Re-do lookup in case of re-hash.</span>
</td><td class="n" data-n="496" id="C1428259NL496"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="n">I</span> <span class="o">=</span> <span class="n">DelayedCXXInitPosition</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">D</span><span class="p">);</span> <span class="c1">// Re-do lookup in case of re-hash.</span>
</td></tr><tr><td class="n" data-n="491" id="C1428259OL491"></td><td class="" data-copy-mode="copy-l">    <span class="k">if</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="n">DelayedCXXInitPosition</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</td><td class="n" data-n="497" id="C1428259NL497"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="k">if</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="n">DelayedCXXInitPosition</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="492" id="C1428259OL492"></td><td class="" data-copy-mode="copy-l">      <span class="n">CXXGlobalInits</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Fn</span><span class="p">);</span>
</td><td class="n" data-n="498" id="C1428259NL498"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">      <span class="n">CXXGlobalInits</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Fn</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="493" id="C1428259OL493"></td><td class="" data-copy-mode="copy-l">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">!=</span> <span class="o">~</span><span class="mi">0U</span><span class="p">)</span> <span class="p">{</span>
</td><td class="n" data-n="499" id="C1428259NL499"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">!=</span> <span class="o">~</span><span class="mi">0U</span><span class="p">)</span> <span class="p">{</span>
</td></tr><tr><td class="n" data-n="494" id="C1428259OL494"></td><td class="" data-copy-mode="copy-l">      <span class="n">assert</span><span class="p">(</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;</span> <span class="n">CXXGlobalInits</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
</td><td class="n" data-n="500" id="C1428259NL500"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">      <span class="n">assert</span><span class="p">(</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;</span> <span class="n">CXXGlobalInits</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
</td></tr><tr><td class="n" data-n="495" id="C1428259OL495"></td><td class="" data-copy-mode="copy-l">             <span class="n">CXXGlobalInits</span><span class="p">[</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">]</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">);</span>
</td><td class="n" data-n="501" id="C1428259NL501"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">             <span class="n">CXXGlobalInits</span><span class="p">[</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">]</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="496" id="C1428259OL496"></td><td class="" data-copy-mode="copy-l">      <span class="n">CXXGlobalInits</span><span class="p">[</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fn</span><span class="p">;</span>
</td><td class="n" data-n="502" id="C1428259NL502"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">      <span class="n">CXXGlobalInits</span><span class="p">[</span><span class="n">I</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fn</span><span class="p">;</span>
</td></tr><tr data-sigil="context-target"><td class="show-context-line n left-context"></td><td class="show-more"><a data-meta="2_4" data-mustcapture="1" data-sigil="show-more" href="#">▲ Show 20 Lines</a> • <a data-meta="2_5" data-mustcapture="1" data-sigil="show-more" href="#">Show All 239 Lines</a> • <a data-meta="2_6" data-mustcapture="1" data-sigil="show-more" href="#">Show Last 20 Lines</a></td><td class="show-context-line n"></td><td class="show-context" colspan="3"></td></tr></tbody></table></div></div><div class="differential-changeset" data-autoid="autoid_6" data-meta="0_192" data-sigil="differential-changeset" id="diff-change-8FNeP00duYz7"><legend class="phabricator-anchor-navigation-marker" data-meta="0_190" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="change-8FNeP00duYz7" name="change-8FNeP00duYz7"></a><h1 class="differential-file-icon-header" data-sigil="changeset-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o" data-meta="0_191"></span><span class="differential-changeset-path-name" data-sigil="changeset-header-path-name">test/CodeGenCXX/microsoft-abi-template-static-init.cpp</span></h1><div class="changeset-view-content" data-sigil="changeset-view-content"><ul class="differential-meta-notice"><li>This file was added.</li></ul><table class="differential-diff remarkup-code PhabricatorMonospaced diff-2up" data-sigil="differential-diff intercept-copy"><colgroup><col class="num"/><col class="left"/><col class="num"/><col class="copy"/><col class="right"/><col class="cov"/></colgroup><tbody><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1" id="C1428260NL1"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span></span><span class="c1">// RUN: %clang_cc1 %s -triple=i686-pc-win32 -fms-extensions -emit-llvm -o - | FileCheck %s</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="2" id="C1428260NL2"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// RUN: %clang_cc1 %s -triple=x86_64-pc-win32 -fms-extensions -emit-llvm -o - | FileCheck %s</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="3" id="C1428260NL3"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// RUN: %clang_cc1 %s -triple=i686-pc-windows-msvc -fms-extensions -emit-llvm -o - | FileCheck %s</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="4" id="C1428260NL4"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// RUN: %clang_cc1 %s -triple=x86_64-pc-windows-msvc  -fms-extensions -emit-llvm -o - | FileCheck %s</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="5" id="C1428260NL5"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="6" id="C1428260NL6"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">S</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="7" id="C1428260NL7"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="n">S</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="8" id="C1428260NL8"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="o">~</span><span class="n">S</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="9" id="C1428260NL9"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="10" id="C1428260NL10"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="11" id="C1428260NL11"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nc">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">ExportedTemplate</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="12" id="C1428260NL12"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="k">static</span> <span class="n">S</span> <span class="n">s</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="13" id="C1428260NL13"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="14" id="C1428260NL14"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="n">S</span> <span class="n">ExportedTemplate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">s</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="15" id="C1428260NL15"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kt">void</span> <span class="nf">useExportedTemplate</span><span class="p">(</span><span class="n">ExportedTemplate</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="16" id="C1428260NL16"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">x</span><span class="p">.</span><span class="n">s</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="17" id="C1428260NL17"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="18" id="C1428260NL18"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kt">int</span> <span class="nf">f</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="19" id="C1428260NL19"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">namespace</span> <span class="nn">selectany_init</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="20" id="C1428260NL20"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// MS don't put selectany static var in the linker directive, init routine</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="21" id="C1428260NL21"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// f() is not getting called if x is not referenced.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="22" id="C1428260NL22"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kt">int</span> <span class="nf">__declspec</span><span class="p">(</span><span class="n">selectany</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="23" id="C1428260NL23"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kr">inline</span> <span class="kt">int</span> <span class="nf">__declspec</span><span class="p">(</span><span class="n">selectany</span><span class="p">)</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="24" id="C1428260NL24"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="25" id="C1428260NL25"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="26" id="C1428260NL26"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">namespace</span> <span class="nn">explicit_template_instantiation</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="27" id="C1428260NL27"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nc">A</span> <span class="p">{</span> <span class="k">static</span>  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span> <span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="28" id="C1428260NL28"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="kt">int</span> <span class="n">A</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="29" id="C1428260NL29"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="k">struct</span> <span class="nc">A</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="30" id="C1428260NL30"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="31" id="C1428260NL31"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="32" id="C1428260NL32"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">namespace</span> <span class="nn">implicit_template_instantiation</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="33" id="C1428260NL33"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nc">A</span> <span class="p">{</span> <span class="k">static</span>  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span> <span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="34" id="C1428260NL34"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span>  <span class="kt">int</span> <span class="n">A</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="35" id="C1428260NL35"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kt">int</span> <span class="nf">g</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">x</span><span class="p">;</span> <span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="36" id="C1428260NL36"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="37" id="C1428260NL37"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="38" id="C1428260NL38"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="39" id="C1428260NL39"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="40" id="C1428260NL40"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">X_</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="41" id="C1428260NL41"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="k">static</span> <span class="n">T</span> <span class="n">ioo</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="42" id="C1428260NL42"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="k">static</span> <span class="n">T</span> <span class="nf">init</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="43" id="C1428260NL43"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="44" id="C1428260NL44"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">X_</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">ioo</span> <span class="o">=</span> <span class="n">X_</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">init</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="45" id="C1428260NL45"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="k">struct</span> <span class="nc">X_</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="46" id="C1428260NL46"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="47" id="C1428260NL47"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="48" id="C1428260NL48"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">X</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="49" id="C1428260NL49"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="k">static</span> <span class="n">T</span> <span class="n">ioo</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="50" id="C1428260NL50"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="k">static</span> <span class="n">T</span> <span class="nf">init</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="51" id="C1428260NL51"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="52" id="C1428260NL52"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// template specialized static data don't need in llvm.used,</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="53" id="C1428260NL53"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// the static init routine get call from _GLOBAL__sub_I_ routines.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="54" id="C1428260NL54"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="kt">int</span> <span class="n">X</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">ioo</span> <span class="o">=</span> <span class="n">X</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">init</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="55" id="C1428260NL55"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="k">struct</span> <span class="nc">X</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="56" id="C1428260NL56"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="57" id="C1428260NL57"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">public</span><span class="o">:</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="58" id="C1428260NL58"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="n">a</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="59" id="C1428260NL59"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="60" id="C1428260NL60"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// For the static var inside unnamed namespace, the object is local to TU.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="61" id="C1428260NL61"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// No need to put static var in the linker directive.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="62" id="C1428260NL62"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// The static init routine is called before main.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="63" id="C1428260NL63"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">namespace</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="64" id="C1428260NL64"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">aj</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="65" id="C1428260NL65"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">public</span><span class="o">:</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="66" id="C1428260NL66"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="k">static</span> <span class="n">a</span> <span class="n">al</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="67" id="C1428260NL67"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="68" id="C1428260NL68"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">am</span><span class="o">&gt;</span> <span class="n">a</span> <span class="n">aj</span><span class="o">&lt;</span><span class="n">am</span><span class="o">&gt;::</span><span class="n">al</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="69" id="C1428260NL69"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">class</span> <span class="nc">b</span> <span class="o">:</span> <span class="n">aj</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="70" id="C1428260NL70"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="kt">void</span> <span class="nf">c</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="71" id="C1428260NL71"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="72" id="C1428260NL72"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kt">void</span> <span class="nf">b::c</span><span class="p">()</span> <span class="p">{</span> <span class="n">al</span><span class="p">;</span> <span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="73" id="C1428260NL73"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="74" id="C1428260NL74"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="75" id="C1428260NL75"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// C++17, inline static data member also need to use</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="76" id="C1428260NL76"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">A</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="77" id="C1428260NL77"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="78" id="C1428260NL78"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="n">A</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="79" id="C1428260NL79"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="o">~</span><span class="n">A</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="80" id="C1428260NL80"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="81" id="C1428260NL81"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="82" id="C1428260NL82"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">S1</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="83" id="C1428260NL83"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="84" id="C1428260NL84"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="kr">inline</span> <span class="k">static</span> <span class="n">A</span> <span class="n">aoo</span><span class="p">;</span> <span class="c1">// C++17 inline variable, thus also a definition</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="85" id="C1428260NL85"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="86" id="C1428260NL86"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="87" id="C1428260NL87"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kt">int</span> <span class="nf">foo</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="88" id="C1428260NL88"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kr">inline</span> <span class="kt">int</span> <span class="n">zoo</span> <span class="o">=</span> <span class="n">foo</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="89" id="C1428260NL89"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="kr">inline</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">boo</span> <span class="o">=</span> <span class="n">foo</span><span class="p">();</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="90" id="C1428260NL90"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="91" id="C1428260NL91"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="92" id="C1428260NL92"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK: @llvm.used = appending global [7 x i8*] [i8* bitcast (i32* @"?x1@selectany_init@@3HA" to i8*), i8* bitcast (i32* @"?x@?$A@H@explicit_template_instantiation@@2HA" to i8*), i8* bitcast (i32* @"?ioo@?$X_@H@@2HA" to i8*), i8* getelementptr inbounds (%struct.A, %struct.A* @"?aoo@S1@@2UA@@A", i32 0, i32 0), i8* bitcast (i32* @"?zoo@@3HA" to i8*), i8* getelementptr inbounds (%struct.S, %struct.S* @"?s@?$ExportedTemplate@H@@2US@@A", i32 0, i32 0), i8* bitcast (i32* @"?x@?$A@H@implicit_template_instantiation@@2HA" to i8*)], section "llvm.metadata"</span>
</td></tr></tbody></table></div></div><div class="differential-changeset" data-autoid="autoid_7" data-meta="0_197" data-sigil="differential-changeset" id="diff-change-YYFydCIQ4H5D"><legend class="phabricator-anchor-navigation-marker" data-meta="0_195" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="change-YYFydCIQ4H5D" name="change-YYFydCIQ4H5D"></a><h1 class="differential-file-icon-header" data-sigil="changeset-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o" data-meta="0_196"></span><span class="differential-changeset-path-name" data-sigil="changeset-header-path-name">test/Modules/initializers.cpp</span></h1><div class="changeset-view-content" data-sigil="changeset-view-content"><table class="differential-diff remarkup-code PhabricatorMonospaced diff-2up" data-sigil="differential-diff intercept-copy"><colgroup><col class="num"/><col class="left"/><col class="num"/><col class="copy"/><col class="right"/><col class="cov"/></colgroup><tbody><tr data-sigil="context-target"><td class="show-context-line n left-context"></td><td class="show-more"><a data-meta="4_0" data-mustcapture="1" data-sigil="show-more" href="#">Show First 20 Lines</a> • <a data-meta="4_1" data-mustcapture="1" data-sigil="show-more" href="#">Show All 229 Lines</a> • <a data-meta="4_2" data-mustcapture="1" data-sigil="show-more" href="#">▼ Show 20 Lines</a></td><td class="show-context-line n"></td><td class="show-context" colspan="3"></td></tr><tr><td class="n" data-n="230" id="C1428261OL230"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="230" id="C1428261NL230"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n" data-n="231" id="C1428261OL231"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: define {{.*}} @[[D_INIT:__cxx_global.*]]()</span>
</td><td class="n" data-n="231" id="C1428261NL231"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: define {{.*}} @[[D_INIT:__cxx_global.*]]()</span>
</td></tr><tr><td class="n" data-n="232" id="C1428261OL232"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: load {{.*}} (i64* @_ZGV</span>
</td><td class="n" data-n="232" id="C1428261NL232"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: load {{.*}} (i64* @_ZGV</span>
</td></tr><tr><td class="n" data-n="233" id="C1428261OL233"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: store {{.*}}, i32* @[[D]],</span>
</td><td class="n" data-n="233" id="C1428261NL233"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: store {{.*}}, i32* @[[D]],</span>
</td></tr><tr><td class="n" data-n="234" id="C1428261OL234"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="234" id="C1428261NL234"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n" data-n="235" id="C1428261OL235"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="235" id="C1428261NL235"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n" data-n="236" id="C1428261OL236"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: define {{.*}} @[[TU_INIT]]()</span>
</td><td class="n" data-n="236" id="C1428261NL236"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: define {{.*}} @[[TU_INIT]]()</span>
</td></tr><tr><td class="n" data-n="237" id="C1428261OL237"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: call void @[[A_INIT]]()</span>
</td><td class="n" data-n="237" id="C1428261NL237"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: call void @[[A_INIT]]()</span>
</td></tr><tr><td class="old old-full n" data-n="238" id="C1428261OL238"></td><td class="old old-full" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: call void @[[B_INIT]]()</span>
</td><td class="n"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"></td></tr><tr><td class="n" data-n="239" id="C1428261OL239"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="238" id="C1428261NL238"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n" data-n="240" id="C1428261OL240"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: define {{.*}} @__tls_init()</span>
</td><td class="n" data-n="239" id="C1428261NL239"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: define {{.*}} @__tls_init()</span>
</td></tr><tr><td class="n" data-n="241" id="C1428261OL241"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: call void @[[C_INIT]]()</span>
</td><td class="n" data-n="240" id="C1428261NL240"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: call void @[[C_INIT]]()</span>
</td></tr><tr><td class="n" data-n="242" id="C1428261OL242"></td><td class="" data-copy-mode="copy-l"><span class="c1">// CHECK-IMPORT: call void @[[D_INIT]]()</span>
</td><td class="n" data-n="241" id="C1428261NL241"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="c1">// CHECK-IMPORT: call void @[[D_INIT]]()</span>
</td></tr></tbody></table></div></div></div></div></div></div></div></div><div class="phui-formation-view-expander phui-formation-view-expander-left" data-autoid="autoid_2" data-meta="0_205" data-sigil="has-tooltip" id="UQ0_74" style=""><div class="phui-formation-view-expander-icon"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-chevron-right grey" data-meta="0_204"></span></div></div></td></tr></tbody></table></div></div></div><script src="overrides/js/core.pkg.js" type="text/javascript"></script><script src="overrides/js/differential.pkg.js" type="text/javascript"></script><data data-javelin-init-data='{"block":0,"data":[[],{"keyCommand":"t"},[],{"keyCommand":"f"},[],{"keyCommand":"?"},[],[],[],{"hoverPHID":"PHID-USER-t6kjd44psot7war32mez"},{"hoverPHID":"PHID-USER-eggyni4cxnnfmbsekohj"},{"hoverPHID":"PHID-USER-j5t6lbevphhnqutqnfge"},{"hoverPHID":"PHID-USER-kdjv7ia723hmikacshbs"},{"tip":"Accepted","size":240},{"tip":"Review Requested","size":240},{"tip":"Review Requested","size":240},{"tip":"Review Requested","size":240},[],{"tabMap":["UQ0_10"]},{"hoverPHID":"PHID-DREV-hncji3lc7sulkza3cuab"},{"hoverPHID":"PHID-USER-t6kjd44psot7war32mez"},{"hoverPHID":"PHID-DREV-hncji3lc7sulkza3cuab"},{"hoverPHID":"PHID-USER-af6ehxiw57suh4rbqsie"},{"hoverPHID":"PHID-DREV-hncji3lc7sulkza3cuab"},{"hoverPHID":"PHID-DREV-hncji3lc7sulkza3cuab"},{"hoverPHID":"PHID-USER-af6ehxiw57suh4rbqsie"},{"hoverPHID":"PHID-USER-t6kjd44psot7war32mez"},{"hoverPHID":"PHID-USER-3t5gajzrwopnc5f6gl3u"},{"hoverPHID":"PHID-CMIT-efz4jjvxmsnaxdv6kgie"},{"hoverPHID":"PHID-DREV-u7xajzicmuktsfctvycr"},[],{"phid":"PHID-XACT-DREV-f6pweq3zqqcc3uh"},{"phid":"PHID-XACT-DREV-rpv56utomjxcy52"},{"phid":"PHID-XACT-DREV-vfrq27dpxjfvneg"},{"phid":"PHID-XACT-DREV-rmvidlkid5ajwoo"},{"phid":"PHID-XACT-DREV-rw5tdl5dvq6d43o"},{"phid":"PHID-XACT-DREV-c4eiuvkmz47kbn5"},{"phid":"PHID-XACT-DREV-haphkvu6moanxyv"},{"phid":"PHID-XACT-DREV-lu4l73heyxdk4le"},{"hoverPHID":"PHID-USER-3t5gajzrwopnc5f6gl3u"},{"phid":"PHID-XACT-DREV-tdvhtnlovilwgdf"},{"phid":"PHID-XACT-DREV-5kxwztdx5yi7qom"},{"phid":"PHID-XACT-DREV-4rwrbd2hhkqkbhu"},{"hoverPHID":"PHID-USER-kqjyf5hormnotsj4ckac"},{"phid":"PHID-XACT-DREV-ku4gah4kelnpp7p"},{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-mvqlnvuvvlk7ens","anchor":"1472902"},{"tip":"Via Herald"},[],{"phid":"PHID-XACT-DREV-boavwlkrqxldfad","anchor":"1472911"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-f6pweq3zqqcc3uh\/","ref":"D60912#1472983"},[],{"anchor":"1472983"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_13\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_51\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_52\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_15\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-f6pweq3zqqcc3uh\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_53\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_54\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],[],[],{"phid":"PHID-XACT-DREV-f6pweq3zqqcc3uh","anchor":"1472983"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-vfrq27dpxjfvneg\/","ref":"D60912#1472986"},[],{"anchor":"1472986"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_17\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_62\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_63\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_19\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-vfrq27dpxjfvneg\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_64\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_65\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-vfrq27dpxjfvneg","anchor":"1472986"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-rmvidlkid5ajwoo\/","ref":"D60912#1472987"},[],{"anchor":"1472987"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_21\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_71\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_72\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_23\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-rmvidlkid5ajwoo\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_73\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_74\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-rmvidlkid5ajwoo","anchor":"1472987"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-rw5tdl5dvq6d43o\/","ref":"D60912#1473036"},[],{"anchor":"1473036"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_25\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_80\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_81\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_27\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-rw5tdl5dvq6d43o\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_82\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_83\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-rw5tdl5dvq6d43o","anchor":"1473036"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-c4eiuvkmz47kbn5\/","ref":"D60912#1476354"},[],{"anchor":"1476354"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_29\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_89\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_90\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_31\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-c4eiuvkmz47kbn5\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_91\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_92\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],[],[],{"phid":"PHID-XACT-DREV-k5xcj3g2nojjhmc","anchor":"1476354"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-haphkvu6moanxyv\/","ref":"D60912#1476373"},[],{"anchor":"1476373"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_33\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_100\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_101\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_35\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-haphkvu6moanxyv\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_102\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_103\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],[],[],{"phid":"PHID-XACT-DREV-xe5q7zama4gpn2c","anchor":"1476373"},{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-7fjnqakcjvqe54z","anchor":"1476376"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-tdvhtnlovilwgdf\/","ref":"D60912#1479008"},[],{"anchor":"1479008"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_37\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_114\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_115\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_39\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-tdvhtnlovilwgdf\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_116\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_117\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-346erxw2hk45rt3","anchor":"1479008"},{"tip":"Via Web"},[],[],[],[],{"phid":"PHID-XACT-DREV-574lb4jh3ysszvo","anchor":"1479071"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-4rwrbd2hhkqkbhu\/","ref":"D60912#1479074"},[],{"anchor":"1479074"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_41\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_129\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_130\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_43\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-4rwrbd2hhkqkbhu\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_131\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_132\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-hycjgq7iivkbpn5","anchor":"1479074"},{"tip":"Via Web"},[],[],[],[],{"phid":"PHID-XACT-DREV-szvdrlnftadkvfi","anchor":"2909029"},[],[],[],[],{"itemIDs":["UQ0_51","UQ0_52"],"caretID":"UQ0_50"},[],[],[],{"itemIDs":["UQ0_57"],"caretID":"UQ0_56"},[],[],[],[],[],[],{"hoverPHID":"PHID-PROJ-lozknewkz7sgtf34jasi"},{"anchor":"toc"},[],[],[],[],[],{"id":"diff-change-5K4eV4tdqMqW"},[],[],[],[],[],[],{"id":"diff-change-8FNeP00duYz7"},[],[],[],[],{"id":"diff-change-YYFydCIQ4H5D"},{"tabMap":{"files":"UQ0_68","history":"UQ0_69","commits":"UQ0_70"}},{"tabKey":"files"},{"tabKey":"history"},{"tabKey":"commits"},{"standaloneURI":"\/differential\/changeset\/?ref=1428259","leftURI":"\/differential\/changeset\/?view=old&amp;ref=1428259","rightURI":"\/differential\/changeset\/?view=new&amp;ref=1428259","containerID":"diff-change-5K4eV4tdqMqW"},[],{"anchor":"change-5K4eV4tdqMqW"},[],{"left":"1428259","right":"1428259","renderURI":"\/differential\/changeset\/","ref":"1428259","autoload":true,"displayPath":"\u003cspan class=\"diff-banner-path\"\u003elib\/CodeGen\/\u003c\/span\u003e\u003cspan class=\"diff-banner-file\"\u003eCGDeclCXX.cpp\u003c\/span\u003e","icon":"fa-file-text-o","pathParts":["lib","CodeGen","CGDeclCXX.cpp"],"pathIconIcon":"fa-file-text-o","pathIconColor":"bluetext","isLowImportance":false,"isOwned":false,"editorURITemplate":null,"editorConfigureURI":null,"loaded":false,"changesetState":null,"showPathURI":null,"showDirectoryURI":null},{"standaloneURI":"\/differential\/changeset\/?ref=1428260","rightURI":"\/differential\/changeset\/?view=new&amp;ref=1428260","containerID":"diff-change-8FNeP00duYz7"},[],{"anchor":"change-8FNeP00duYz7"},[],{"left":"1428260","right":"1428260","renderURI":"\/differential\/changeset\/","ref":"1428260","autoload":true,"displayPath":"\u003cspan class=\"diff-banner-path\"\u003etest\/CodeGenCXX\/\u003c\/span\u003e\u003cspan class=\"diff-banner-file\"\u003emicrosoft-abi-template-static-init.cpp\u003c\/span\u003e","icon":"fa-file-text-o","pathParts":["test","CodeGenCXX","microsoft-abi-template-static-init.cpp"],"pathIconIcon":"fa-plus","pathIconColor":"create-color","isLowImportance":false,"isOwned":false,"editorURITemplate":null,"editorConfigureURI":null,"loaded":false,"changesetState":null,"showPathURI":null,"showDirectoryURI":null},{"standaloneURI":"\/differential\/changeset\/?ref=1428261","leftURI":"\/differential\/changeset\/?view=old&amp;ref=1428261","rightURI":"\/differential\/changeset\/?view=new&amp;ref=1428261","containerID":"diff-change-YYFydCIQ4H5D"},[],{"anchor":"change-YYFydCIQ4H5D"},[],{"left":"1428261","right":"1428261","renderURI":"\/differential\/changeset\/","ref":"1428261","autoload":true,"displayPath":"\u003cspan class=\"diff-banner-path\"\u003etest\/Modules\/\u003c\/span\u003e\u003cspan class=\"diff-banner-file\"\u003einitializers.cpp\u003c\/span\u003e","icon":"fa-file-text-o","pathParts":["test","Modules","initializers.cpp"],"pathIconIcon":"fa-file-text-o","pathIconColor":"bluetext","isLowImportance":false,"isOwned":false,"editorURITemplate":null,"editorConfigureURI":null,"loaded":false,"changesetState":null,"showPathURI":null,"showDirectoryURI":null},{"menuID":"UQ0_0"},[],[],[],[],[],[],{"tip":null,"align":"E"},{"items":[{"itemID":"UQ0_2","width":240,"isVisible":false,"isRightAligned":false,"expanderID":"UQ0_74","resizer":{"itemID":"UQ0_7","controlID":"UQ0_8","widthKey":null,"visibleKey":null,"minimumWidth":150,"maximumWidth":512},"column":{"type":"flank","nodeID":"UQ0_6","isFixed":true,"headID":"UQ0_3","bodyID":"UQ0_4","tailID":"UQ0_5"}},{"itemID":"UQ0_7","width":8,"isVisible":false,"isRightAligned":null,"expanderID":null,"resizer":null,"column":null},{"itemID":"UQ0_9","width":null,"isVisible":true,"isRightAligned":null,"expanderID":null,"resizer":null,"column":null}]},{"map":{"UQ0_75":"phabricator-search-menu-expanded","UQ0_92":"menu-icon-selected"}},{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_77\" class=\"phabricator-action-view phabricator-action-view-type-label\" style=\"\"\u003e\u003cspan class=\"phabricator-action-view-item\"\u003eQueries\u003c\/span\u003e\u003c\/li\u003e\u003cli id=\"UQ0_79\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/VwhkLxBeXCJ6\/\" class=\"phabricator-action-view-item\"\u003eActive Revisions, recently changed first\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_81\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/all\/\" class=\"phabricator-action-view-item\"\u003eAll Revisions\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_83\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/kpppzQLwFaBm\/\" class=\"phabricator-action-view-item\"\u003eMLIR Open Revisions\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_85\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/M5vQzZOH04.6\/\" class=\"phabricator-action-view-item\"\u003eLibc++ Open Reviews\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_87\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/cHsGxkHENcUs\/\" class=\"phabricator-action-view-item\"\u003eLibc++ Open Reviews - Review Needed\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_89\" class=\"phabricator-action-view phabricator-action-view-type-label\" style=\"\"\u003e\u003cspan class=\"phabricator-action-view-item\"\u003eSearch\u003c\/span\u003e\u003c\/li\u003e\u003cli id=\"UQ0_91\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/advanced\/\" class=\"phabricator-action-view-item\"\u003eAdvanced Search\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"items":[{"name":"Search"},{"icon":"fa-globe","name":"All Documents","value":"all"},{"icon":"fa-cog","name":"Current Application","value":"application"},{"name":"Saved Queries"},{"icon":"fa-certificate","name":"Open Documents","value":"open"},{"icon":"fa-certificate","name":"Open Tasks","value":"open-tasks"},{"name":"More Options"},{"icon":"fa-search-plus","name":"Advanced Search","href":"\/search\/query\/advanced\/"},{"icon":"fa-book","name":"User Guide: Search","href":"https:\/\/secure.phabricator.com\/diviner\/find\/?name=Search%20User%20Guide&amp;type=article&amp;jump=1"}],"icon":"fa-globe","value":"all"},[]]}' data-javelin-init-kind="merge"></data><data data-javelin-init-data='{"refresh-csrf":[{"tokenName":"__csrf__","header":"X-Phabricator-Csrf","viaHeader":"X-Phabricator-Via","current":"B@6upk4vzx0b91430f0e358883"}],"history-install":[]}' data-javelin-init-kind="behaviors"></data><data data-javelin-init-data='{"phui-hovercards":[],"phabricator-tooltips":[],"phui-tab-group":[],"phabricator-transaction-list":[],"phabricator-show-older-transactions":[{"timelineID":"UQ0_11","viewData":{"left":"196346","right":"196346","old":"1428259,1428260,1428261","new":"1428259,1428260,1428261"}}],"phabricator-watch-anchor":[],"phui-dropdown-menu":[],"phui-submenu":[],"differential-diff-radios":[{"radios":["UQ0_71","UQ0_72"]}],"phabricator-oncopy":[],"differential-populate":[{"changesetViewIDs":["diff-change-5K4eV4tdqMqW","diff-change-8FNeP00duYz7","diff-change-YYFydCIQ4H5D"],"formationViewID":"UQ0_73","inlineURI":null,"inlineListURI":"\/differential\/revision\/inlines\/60912\/","isStandalone":null,"pht":{"Open in Editor":"Open in Editor","Show All Context":"Show All Context","All Context Shown":"All Context Shown","Expand File":"Expand File","Hide Changeset":"Hide Changeset","Show Path in Repository":"Show Path in Repository","Show Directory in Repository":"Show Directory in Repository","View Standalone":"View Standalone","Show Raw File (Left)":"Show Raw File (Left)","Show Raw File (Right)":"Show Raw File (Right)","Configure Editor":"Configure Editor","Load Changes":"Load Changes","View Side-by-Side Diff":"View Side-by-Side Diff","View Unified Diff":"View Unified Diff","Change Text Encoding...":"Change Text Encoding...","Highlight As...":"Highlight As...","View As Document Type...":"View As Document Type...","Loading...":"Loading...","Editing Comment":"Editing Comment","Jump to next change.":"Jump to next change.","Jump to previous change.":"Jump to previous change.","Jump to next file.":"Jump to next file.","Jump to previous file.":"Jump to previous file.","Jump to next inline comment.":"Jump to next inline comment.","Jump to previous inline comment.":"Jump to previous inline comment.","Jump to the table of contents.":"Jump to the table of contents.","Edit selected inline comment.":"Edit selected inline comment.","You must select a comment to edit.":"You must select a comment to edit.","Reply to selected inline comment or change.":"Reply to selected inline comment or change.","You must select a comment or change to reply to.":"You must select a comment or change to reply to.","Reply and quote selected inline comment.":"Reply and quote selected inline comment.","Mark or unmark selected inline comment as done.":"Mark or unmark selected inline comment as done.","You must select a comment to mark done.":"You must select a comment to mark done.","Collapse or expand inline comment.":"Collapse or expand inline comment.","You must select a comment to hide.":"You must select a comment to hide.","Jump to next inline comment, including collapsed comments.":"Jump to next inline comment, including collapsed comments.","Jump to previous inline comment, including collapsed comments.":"Jump to previous inline comment, including collapsed comments.","Hide or show the current changeset.":"Hide or show the current changeset.","You must select a file to hide or show.":"You must select a file to hide or show.","Unsaved":"Unsaved","Unsubmitted":"Unsubmitted","Comments":"Comments","Hide \"Done\" Inlines":"Hide \"Done\" Inlines","Hide Collapsed Inlines":"Hide Collapsed Inlines","Hide Older Inlines":"Hide Older Inlines","Hide All Inlines":"Hide All Inlines","Show All Inlines":"Show All Inlines","List Inline Comments":"List Inline Comments","Display Options":"Display Options","Hide or show all inline comments.":"Hide or show all inline comments.","Finish editing inline comments before changing display modes.":"Finish editing inline comments before changing display modes.","Open file in external editor.":"Open file in external editor.","You must select a file to edit.":"You must select a file to edit.","You must select a file to open.":"You must select a file to open.","No external editor is configured.":"No external editor is configured.","Hide or show the paths panel.":"Hide or show the paths panel.","Show path in repository.":"Show path in repository.","Show directory in repository.":"Show directory in repository.","Jump to the comment area.":"Jump to the comment area.","Show Changeset":"Show Changeset","You must select source text to create a new inline comment.":"You must select source text to create a new inline comment.","New Inline Comment":"New Inline Comment","Add new inline comment on selected source text.":"Add new inline comment on selected source text.","Suggest Edit":"Suggest Edit","Discard Edit":"Discard Edit"}}],"workflow":[],"lightbox-attachments":[],"aphront-form-disable-on-submit":[],"toggle-class":[],"phabricator-gesture":[],"device":[],"high-security-warning":[{"show":false,"uri":"\/auth\/session\/downgrade\/","message":"Your session is in high security mode. When you finish using it, click here to leave."}],"phabricator-keyboard-shortcuts":[{"helpURI":"\/help\/keyboardshortcut\/","searchID":"UQ0_93","pht":{"\/":"Give keyboard focus to the search box.","?":"Show keyboard shortcut help for the current page."}}],"phabricator-search-typeahead":[{"id":"UQ0_94","input":"UQ0_93","button":"UQ0_95","selectorID":"UQ0_96","applicationID":"UQ0_97","defaultApplicationIcon":"fa-dot-circle-o","appScope":"application","src":"\/typeahead\/class\/PhabricatorSearchDatasource\/","limit":10,"placeholder":"Search","scopeUpdateURI":"\/settings\/adjust\/?key=search-scope"}],"quicksand-blacklist":[{"patterns":["\/phame\/live\/.*","\/conpherence\/.*","\/Z\\d+","\/file\/(data|download)\/.*","\/phortune\/.*","\/auth\/.*"]}]}' data-javelin-init-kind="behaviors"></data></body></html>