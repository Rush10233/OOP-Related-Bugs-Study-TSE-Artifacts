<!DOCTYPE html>
<html><head><meta charset="utf-8"/><title>âš™ D3935 Fix PR19876 - Generic lambdas that capture 'this' used within NSDMIs result in a crash</title><meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/><link color="#3D4B67" href="overrides/favicon/mask-icon.svg" rel="mask-icon"/><link href="overrides/favicon/favicon-76" rel="apple-touch-icon" sizes="76x76"/><link href="overrides/favicon/favicon-120" rel="apple-touch-icon" sizes="120x120"/><link href="overrides/favicon/favicon-152" rel="apple-touch-icon" sizes="152x152"/><link href="overrides/favicon/favicon" id="favicon" rel="icon"/><meta content="no-referrer" name="referrer"/><link href="overrides/css/differential.pkg.css" rel="stylesheet" type="text/css"/><link href="overrides/css/core.pkg.css" rel="stylesheet" type="text/css"/><script src="overrides/js/init.js" type="text/javascript"></script></head><body class="device-desktop platform-linux phui-theme-blindigo" id=""><div class="main-page-frame" data-autoid="autoid_13" id="main-page-frame"><div class="phabricator-standard-page" id="phabricator-standard-page"><div class="phabricator-main-menu phabricator-main-menu-background" id="UQ0_46"><a class="phabricator-core-user-menu phabricator-core-user-mobile-menu" data-meta="0_96" data-sigil="phui-dropdown-menu" href="#" role="button"><span class="aural-only">Page Menu</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-bars" data-meta="0_97"></span><span class="caret"></span></a><a class="phabricator-main-menu-search-button phabricator-expand-application-menu" data-meta="0_95" data-sigil="jx-toggle-class"><span class="phabricator-menu-button-icon phui-icon-view phui-font-fa fa-search" id="UQ0_63"></span></a><a class="phabricator-main-menu-brand" href="/"><span class="aural-only">Home</span><span class="phabricator-main-menu-eye" style=""></span><span class="phabricator-wordmark">Phabricator</span></a></div><div style="background-color: crimson; color: white; text-align: center; padding: 0.3rem 0;"><h1>This is an archive of the discontinued LLVM Phabricator instance.</h1></div><div class="phabricator-standard-page-body" id="phabricator-standard-page-body"><table class="phui-formation-view" data-meta="0_94" data-sigil="phuix-formation-view" id="UQ0_44"><tbody><tr><td class="phui-formation-desktop-only" data-autoid="autoid_1" id="UQ0_2" style="width: 240px; display: none;"><div class="phui-flank-view phui-flank-view-fixed" id="UQ0_6" style="width: 240px; top: 44px;"><div class="phui-flank-view-head" id="UQ0_3"><div class="phui-flank-header"><div class="phui-flank-header-text">Paths</div><div class="phui-flank-header-hide phui-flank-header-hide-left" data-sigil="phui-flank-header-hide"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-chevron-left grey" data-meta="0_0"></span></div></div><ul class="phui-list-view"><li class="phui-list-item-view phui-list-item-type-link phui-list-item-has-icon"><a class="phui-list-item-href" data-meta="0_1" data-sigil="has-key-command" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-list phui-list-item-icon" data-meta="0_2"></span><span class="phui-list-item-name">Table of Contents</span><span class="keyboard-shortcut-key">t</span></a></li></ul></div><div class="phui-flank-view-body" id="UQ0_4" style="max-height: 0px;"><ul class="diff-tree-view"><li class="diff-tree-path" data-autoid="autoid_9"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">lib/Sema/</div></div></li><li class="diff-tree-path" data-autoid="autoid_10" style="display: none;"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">Sema/</div></div></li><li class="diff-tree-path diff-tree-path-changeset" data-autoid="autoid_7"><div class="diff-tree-path-indent" style="margin-left: 8px;"><div class="diff-tree-path-inlines diff-tree-path-inlines-visible">1</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-file-text-o bluetext"></span></div><div class="diff-tree-path-name">SemaExprCXX.cpp</div></div></li><li class="diff-tree-path" data-autoid="autoid_11"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">test/SemaCXX/</div></div></li><li class="diff-tree-path" data-autoid="autoid_12" style="display: none;"><div class="diff-tree-path-indent" style="margin-left: 0px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-folder-open-o grey"></span></div><div class="diff-tree-path-name">SemaCXX/</div></div></li><li class="diff-tree-path diff-tree-path-changeset" data-autoid="autoid_8"><div class="diff-tree-path-indent" style="margin-left: 8px;"><div class="diff-tree-path-inlines">-</div><div class="diff-tree-path-icon diff-tree-path-icon-hidden"><span class="phui-icon-view phui-font-fa fa-times-circle-o"></span></div><div class="diff-tree-path-icon diff-tree-path-icon-kind"><span class="phui-icon-view phui-font-fa fa-file-text-o bluetext"></span></div><div class="diff-tree-path-name">cxx1y-generic-lambdas-capturing.cpp</div></div></li></ul></div><div class="phui-flank-view-tail" id="UQ0_5"><ul class="phui-list-view"><li class="phui-list-item-view phui-list-item-type-link phui-list-item-has-icon"><a class="phui-list-item-href" data-meta="0_3" data-sigil="has-key-command" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-chevron-left phui-list-item-icon" data-meta="0_4"></span><span class="phui-list-item-name">Hide Panel</span><span class="keyboard-shortcut-key">f</span></a></li><li class="phui-list-item-view phui-list-item-type-link phui-list-item-has-icon"><a class="phui-list-item-href" data-meta="0_5" data-sigil="has-key-command" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-keyboard-o phui-list-item-icon" data-meta="0_6"></span><span class="phui-list-item-name">Keyboard Reference</span><span class="keyboard-shortcut-key">?</span></a></li></ul></div></div></td><td class="phui-formation-desktop-only" data-autoid="autoid_3" id="UQ0_7" style="width: 8px; display: none;"><div class="phui-formation-resizer" id="UQ0_8" style="width: 8px;"></div></td><td class="" data-autoid="autoid_4" id="UQ0_9" style=""><div class="phui-formation-view-content"><div class="phui-crumbs-view phui-crumbs-border"><a class="phui-crumb-view phui-crumb-has-icon" href="/differential/"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-cog" data-meta="0_7"></span><span class="phui-crumb-name"> Differential</span> </a><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-angle-right phui-crumb-divider phui-crumb-view" data-meta="0_8"></span><span class="phui-crumb-view phabricator-last-crumb"><span class="phui-crumb-name"> D3935</span> </span></div><div class="phui-two-column-view phui-side-column-right with-subheader"><div class="phui-two-column-container"><div class="phui-two-column-header"><div class="phui-header-shell phui-header-tall"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-cog phui-header-icon" data-meta="0_88"></span>Fix PR19876 - Generic lambdas that capture 'this' used within NSDMIs result in a crash</span><div class="phui-header-subheader"><span class="phui-tag-view phui-tag-type-shade phui-tag-indigo phui-tag-shade phui-tag-icon-view"><span class="phui-tag-core"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check-square-o" data-meta="0_91"></span>Closed</span></span><span class="policy-header-callout"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-globe bluegrey" data-meta="0_90"></span><a class="policy-link" data-sigil="workflow" href="/policy/explain/PHID-DREV-vttjlkzhgiegtisuipun/view/">Public</a></span></div></div><div class="phui-header-col3"></div></div></h1></div></div><div class="phui-two-column-subheader"><div class="phui-head-thing-view phui-head-has-image head-thing-small"><a aria-hidden="true" class="visual-only phui-head-thing-image" href="/p/faisalv/" style="background-image: url(overrides/css/profile.png)"></a>Authored by <strong><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a></strong> on May 27 2014, 10:38 PM.</div></div><div class="phui-two-column-content"><div class="phui-two-column-row grouped"><div class="phui-side-column"><div class=""><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-two-column-properties"><ul class="phabricator-action-list-view" id="UQ0_0"><li class="phabricator-action-view phabricator-action-view-href action-has-icon" id="UQ0_21" style=""><a class="phabricator-action-view-item" href="/D3935?large=true&amp;id=&amp;download=true"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-download phabricator-action-view-icon" data-meta="0_48"></span>Download Raw Diff</a></li></ul></div></div></div><div class="phui-main-column"><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Details</span></div><div class="phui-header-col3"></div></div></h1></div><div class="phui-property-list-section"><div class="phui-property-list-container grouped"><div class="phui-property-list-properties-wrap"><dl class="phui-property-list-properties"><dt class="phui-property-list-key">Reviewers </dt><dd class="phui-property-list-value"><table class="phui-status-list-view"><tbody><tr class=""><td class="phui-status-item-target"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check-circle green" data-meta="0_11" data-sigil="has-tooltip"></span><a class="phui-handle phui-link-person" data-meta="0_9" data-sigil="hovercard" href="/p/rsmith/">rsmith</a></td><td class="phui-status-item-note"></td></tr><tr class=""><td class="phui-status-item-target"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-circle-o bluegrey" data-meta="0_12" data-sigil="has-tooltip"></span><a class="phui-handle phui-link-person" data-meta="0_10" data-sigil="hovercard" href="/p/doug.gregor/">doug.gregor</a></td><td class="phui-status-item-note"></td></tr></tbody></table> </dd></dl></div></div><div class="phui-property-list-section-header"><span class="phui-property-list-section-header-icon"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-align-left bluegrey" data-meta="0_13"></span>Summary</span></div><div class="phui-property-list-text-content"><div class="phabricator-remarkup"><p>See <a class="remarkup-link" href="http://llvm.org/bugs/show_bug.cgi?id=19876" rel="nofollow" target="_blank">http://llvm.org/bugs/show_bug.cgi?id=19876</a></p>

<p>The following C++1y code results in a crash:</p>

<p>struct X {</p>

<div class="remarkup-code-block" data-code-lang="text" data-sigil="remarkup-code-block"><pre class="remarkup-code">int m = 10;
int n = [this](auto) { return m; }(20);</pre></div>

<p>};</p>

<p>This is because when implicitly instantiating the generic lambda's call operator specialization body, Sema gets confused and is unable to determine the current 'this' type when transforming the MemberExpr 'm'.<br/>
That is SemaExprCXX.cpp:Sema::getCurrentThisType() is unable to calculate that the this type should be X* since it looks for the nearest enclosing FunctionDeclDC - which is obviously null.</p>

<p>I suppose there are two ways to fix this:</p>

<ol class="remarkup-list">
<li class="remarkup-list-item">In InstantiateFunctionDefinition, when the context is saved after the lambda scope info is created, retain the 'this' pointer.</li>
<li class="remarkup-list-item">Teach getCurrentThisType() to recognize it is within a generic lambda within an NSDMI and return the appropriate this type.</li>
</ol>

<p>I am not sure which way is definitely better - but either one seemed easy to implement.<br/>
I chose #2 - although I can't think of a good reason for choosing it over #1.  <br/>
Feedback will be welcome  - and especially if there is another option that might be even more robust.</p>

<p>Thanks!</p></div></div></div></div><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Diff Detail</span></div><div class="phui-header-col3"></div></div></h1></div><div class="" data-meta="0_14" data-sigil="phui-tab-group-view"><div id="UQ0_10"><div class=""><div class="phui-property-list-section"></div></div></div></div></div><div class="phui-timeline-view" id="UQ0_11"><h3 class="aural-only">Event Timeline</h3><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-sky" data-meta="0_26" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-minor-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/faisalv/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><a class="phabricator-anchor-view" id="46282" name="46282"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-sky"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-refresh phui-timeline-icon" data-meta="0_19"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> updated this revision to <a class="phui-handle" href="/differential/diff/9862/">Diff 9862</a>.<span class="phui-timeline-extra"><a data-meta="0_18" data-sigil="has-tooltip" href="#46282">May 27 2014, 10:38 PM</a></span></div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_20"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> retitled this revision from <span class="phui-timeline-value"></span> to <span class="phui-timeline-value">[PATCH] Fix PR19876 - Generic lambdas that capture 'this' used within NSDMIs result in a crash</span>.</div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_21"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> updated this object.</div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_22"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> edited the test plan for this revision. <a data-sigil="workflow" href="/transactions/detail/PHID-XACT-DREV-z7f5n666rh4w3et/">(Show Details)</a></div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-user phui-timeline-icon" data-meta="0_23"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> added reviewers: <a class="phui-handle phui-link-person" href="/p/rsmith/">rsmith</a>, <a class="phui-handle phui-link-person" href="/p/doug.gregor/">doug.gregor</a>.</div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-pencil phui-timeline-icon" data-meta="0_24"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> retitled this revision from <span class="phui-timeline-value">[PATCH] Fix PR19876 - Generic lambdas that capture 'this' used within NSDMIs result in a crash</span> to <span class="phui-timeline-value">Fix PR19876 - Generic lambdas that capture 'this' used within NSDMIs result in a crash</span>.</div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-user-plus phui-timeline-icon" data-meta="0_25"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> added a subscriber: <span class="phui-handle" data-meta="0_15" data-sigil="hovercard">Unknown Object (MLST)</span>.</div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-green" data-meta="0_33" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rsmith/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="46840" name="46840"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-green"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check-circle-o phui-timeline-icon" data-meta="0_28"></span></span><a class="phui-handle phui-link-person" href="/p/rsmith/">rsmith</a> accepted this revision.<span class="phui-timeline-extra"><a data-meta="0_27" data-sigil="has-tooltip" href="#46840">May 29 2014, 8:30 PM</a></span></div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-user phui-timeline-icon" data-meta="0_29"></span></span><a class="phui-handle phui-link-person" href="/p/rsmith/">rsmith</a> edited edge metadata.</div><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment phui-timeline-icon" data-meta="0_30"></span></span><a class="phui-handle phui-link-person" href="/p/rsmith/">rsmith</a> added inline comments.</div><div class="phui-timeline-core-content"><table class="phabricator-inline-summary-table"><tbody><tr><th class="inline-comment-summary-table-header" colspan="3"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-code-o darkbluetext mmr" data-meta="0_31"></span>lib/Sema/SemaExprCXX.cpp</th></tr>
<tr><td class="inline-line-number inline-table-dolumn"><a class="num" href="#inline-32905"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-share darkbluetext mmr" data-meta="0_32"></span>744â€“750</a></td><td class="inline-summary-content inline-table-dolumn" colspan="2"><div class="phabricator-remarkup"><span class="transaction-comment" data-meta="0_16" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>Instead of these comments, I'd say "There are no cv-qualifiers, per [expr.prim.general]p4." Also, please use "default initializer" rather than "NSDMI".</p></div></span></div></td></tr></tbody></table></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-green" data-meta="0_36" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-minor-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/rsmith/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><a class="phabricator-anchor-view" id="46843" name="46843"></a><div class="phui-timeline-title phui-timeline-title-with-icon"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-green"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check phui-timeline-icon" data-meta="0_35"></span></span>This revision is now accepted and ready to land.<span class="phui-timeline-extra"><a data-meta="0_34" data-sigil="has-tooltip" href="#46843">May 29 2014, 8:30 PM</a></span></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div><div class="phui-timeline-shell phui-timeline-indigo" data-meta="0_45" data-sigil="transaction anchor-container"><div class="phui-timeline-event-view phui-timeline-major-event"><div class="phui-timeline-content"><a aria-hidden="true" class="visual-only phui-timeline-image" href="/p/faisalv/" style="background-image: url(overrides/css/profile.png)"></a><div class="phui-timeline-wedge" style=""></div><div class="phui-timeline-group"><div class="phui-timeline-inner-content"><a class="phabricator-anchor-view" id="46865" name="46865"></a><div class="phui-timeline-title phui-timeline-title-with-icon phui-timeline-title-with-menu"><span class="phui-timeline-icon-fill fill-has-color phui-timeline-icon-fill-indigo"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-check phui-timeline-icon" data-meta="0_44"></span></span><a class="phui-handle phui-link-person" href="/p/faisalv/">faisalv</a> closed this revision.<span class="phui-timeline-extra"><a data-meta="0_43" data-sigil="has-tooltip" href="#46865">May 29 2014, 9:48 PM</a></span></div><a aria-expanded="false" aria-haspopup="true" class="phui-timeline-menu" data-meta="0_41" data-sigil="phui-dropdown-menu" href="#"><span class="aural-only">Comment Actions</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-caret-down" data-meta="0_42"></span></a><div class="phui-timeline-core-content"><span class="transaction-comment" data-meta="0_17" data-sigil="transaction-comment"><div class="phabricator-remarkup"><p>Committed as r209874</p>

<p><a class="remarkup-link" href="http://lists.cs.uiuc.edu/pipermail/cfe-commits/Week-of-Mon-20140526/106601.html" rel="nofollow" target="_blank">http://lists.cs.uiuc.edu/pipermail/cfe-commits/Week-of-Mon-20140526/106601.html</a></p></div></span></div></div></div></div></div></div><div class="phui-timeline-event-view phui-timeline-spacer"></div></div></div></div></div><div class="phui-two-column-content phui-two-column-footer"><legend class="phabricator-anchor-navigation-marker" data-meta="0_60" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="toc" name="toc"></a><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Revision Contents</span></div><div class="phui-header-col3"></div></div></h1></div><div class="" data-meta="0_72" data-sigil="phui-tab-group-view"><ul class="phui-list-view phui-list-navbar phui-list-navbar-horizontal"><li class="phui-list-item-view phui-list-item-type-link phui-list-item-selected" data-meta="0_73" data-sigil="phui-tab-view"><a class="phui-list-item-href" data-sigil="" href="#"><span class="phui-list-item-name">Files</span></a></li><li class="phui-list-item-view phui-list-item-type-link" data-meta="0_74" data-sigil="phui-tab-view"><a class="phui-list-item-href" data-sigil="" href="#"><span class="phui-list-item-name">History</span></a></li><li class="phui-list-item-view phui-list-item-type-link" data-meta="0_75" data-sigil="phui-tab-view"><a class="phui-list-item-href" data-sigil="" href="#"><span class="phui-list-item-name">Commits</span></a></li></ul><div id="UQ0_40"><div class=""><div class="aphront-table-wrap"><table class="aphront-table-view aphront-table-view-compact"><tbody><tr><th class="diff-toc-path wide">Path</th><th class="right aphront-table-view-nodevice">Size</th></tr><tr class="diff-toc-no-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 0px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-folder-open-o grey" data-meta="0_63"></span></td><td><div class="">lib/</div></td><td><div class="">Sema/</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice"></td></tr><tr class="alt alt-diff-toc-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 16px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o bluetext" data-meta="0_65"></span></td><td><div class="diff-path-component-new"><a data-meta="0_66" data-sigil="differential-load" href="#change-JoWlj7kxlaXi">SemaExprCXX.cpp</a></div></td></tr><tr class="diff-path-old"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-angle-double-right pink" data-meta="0_64"></span></td><td><div class="diff-path-component-old">SemaExprCXX.cpp	(revision 209704)
</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice">16 lines</td></tr><tr class="diff-toc-no-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 0px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-folder-open-o grey" data-meta="0_68"></span></td><td><div class="">test/</div></td><td><div class="">SemaCXX/</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice"></td></tr><tr class="alt alt-diff-toc-changeset-row"><td class="diff-toc-path wide"><div style="padding-left: 16px;"><table><tbody><tr class="diff-path-new"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o bluetext" data-meta="0_70"></span></td><td><div class="diff-path-component-new"><a data-meta="0_71" data-sigil="differential-load" href="#change-kMBxIITUdfpn">cxx1y-generic-lambdas-capturing.cpp</a></div></td></tr><tr class="diff-path-old"><td><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-angle-double-right pink" data-meta="0_69"></span></td><td><div class="diff-path-component-old">cxx1y-generic-lambdas-capturing.cpp	(revision 209704)
</div></td></tr></tbody></table></div></td><td class="right aphront-table-view-nodevice">15 lines</td></tr></tbody></table></div></div></div><div id="UQ0_41" style="display: none;"><div class=""><form action="/D3935#toc"><div class="aphront-table-wrap"><table class="aphront-table-view"><tbody><tr><th class="pri">Diff</th><th>ID</th><th class="aphront-table-view-nodevice">Base</th><th class="wide">Description</th><th class="date aphront-table-view-nodevice">Created</th><th class="center aphront-table-view-nodevice">Lint</th><th class="center aphront-table-view-nodevice">Unit</th><th class="center differential-update-history-old"></th><th class="center differential-update-history-new"></th></tr><tr class="differential-update-history-old-now"><td class="pri">Base</td><td><a href="/D3935?id="></a></td><td class="aphront-table-view-nodevice"></td><td class="wide">Base</td><td class="date aphront-table-view-nodevice"></td><td class="center aphront-table-view-nodevice"></td><td class="center aphront-table-view-nodevice"></td><td class="center differential-update-history-old"><div class="differential-update-history-radio"><input checked="checked" id="UQ0_43" name="vs" type="radio"/></div></td><td class="center differential-update-history-new"></td></tr><tr class="alt alt-differential-update-history-new-now"><td class="pri">Diff 1</td><td><a href="/D3935?id=9862">9862</a></td><td class="aphront-table-view-nodevice"></td><td class="wide"></td><td class="date aphront-table-view-nodevice">May 27 2014, 10:30 PM</td><td class="center aphront-table-view-nodevice"><div class="lintunit-star" title="Lint Skipped"><span class="diff-star-skip">â˜…</span></div></td><td class="center aphront-table-view-nodevice"><div class="lintunit-star" title="Unit Tests Skipped"><span class="diff-star-skip">â˜…</span></div></td><td class="center differential-update-history-old"></td><td class="center differential-update-history-new"><div class="differential-update-history-radio"><input checked="checked" data-sigil="differential-new-radio" name="id" type="radio" value="9862"/></div></td></tr></tbody></table></div></form></div></div><div id="UQ0_42" style="display: none;"><div class=""></div></div></div></div><div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-object-box-collapsed phui-box-blue-property"><div class="phui-header-shell"><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Diff 9862</span></div><div class="phui-header-col3"></div></div></h1></div><div class="differential-review-stage" id="differential-review-stage"><div class="differential-changeset" data-autoid="autoid_5" data-meta="0_80" data-sigil="differential-changeset" id="diff-change-JoWlj7kxlaXi"><legend class="phabricator-anchor-navigation-marker" data-meta="0_78" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="change-JoWlj7kxlaXi" name="change-JoWlj7kxlaXi"></a><h1 class="differential-file-icon-header" data-sigil="changeset-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o" data-meta="0_79"></span><span class="differential-changeset-path-name" data-sigil="changeset-header-path-name">lib/Sema/SemaExprCXX.cpp</span></h1><div class="changeset-view-content" data-sigil="changeset-view-content"><table class="differential-diff remarkup-code PhabricatorMonospaced diff-2up" data-sigil="differential-diff intercept-copy"><colgroup><col class="num"/><col class="left"/><col class="num"/><col class="copy"/><col class="right"/><col class="cov"/></colgroup><tbody><tr data-sigil="context-target"><td class="show-more" colspan="6">Context not available.</td></tr><tr><td class="n" data-n="15" id="C80653OL15"></td><td class="" data-copy-mode="copy-l"><span></span><span class="cp">#include</span> <span class="cpf">"clang/Sema/SemaInternal.h"</span><span class="cp"></span>
</td><td class="n" data-n="15" id="C80653NL15"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span></span><span class="cp">#include</span> <span class="cpf">"clang/Sema/SemaInternal.h"</span><span class="cp"></span>
</td></tr><tr><td class="n" data-n="16" id="C80653OL16"></td><td class="" data-copy-mode="copy-l"><span class="cp">#include</span> <span class="cpf">"TypeLocBuilder.h"</span><span class="cp"></span>
</td><td class="n" data-n="16" id="C80653NL16"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="cp">#include</span> <span class="cpf">"TypeLocBuilder.h"</span><span class="cp"></span>
</td></tr><tr><td class="n" data-n="17" id="C80653OL17"></td><td class="" data-copy-mode="copy-l"><span class="cp">#include</span> <span class="cpf">"clang/AST/ASTContext.h"</span><span class="cp"></span>
</td><td class="n" data-n="17" id="C80653NL17"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="cp">#include</span> <span class="cpf">"clang/AST/ASTContext.h"</span><span class="cp"></span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="18" id="C80653NL18"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="cp">#include</span> <span class="cpf">"clang/AST/ASTLambda.h"</span><span class="cp"></span>
</td></tr><tr><td class="n" data-n="18" id="C80653OL18"></td><td class="" data-copy-mode="copy-l"><span class="cp">#include</span> <span class="cpf">"clang/AST/CXXInheritance.h"</span><span class="cp"></span>
</td><td class="n" data-n="19" id="C80653NL19"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="cp">#include</span> <span class="cpf">"clang/AST/CXXInheritance.h"</span><span class="cp"></span>
</td></tr><tr><td class="n" data-n="19" id="C80653OL19"></td><td class="" data-copy-mode="copy-l"><span class="cp">#include</span> <span class="cpf">"clang/AST/CharUnits.h"</span><span class="cp"></span>
</td><td class="n" data-n="20" id="C80653NL20"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="cp">#include</span> <span class="cpf">"clang/AST/CharUnits.h"</span><span class="cp"></span>
</td></tr><tr><td class="n" data-n="20" id="C80653OL20"></td><td class="" data-copy-mode="copy-l"><span class="cp">#include</span> <span class="cpf">"clang/AST/DeclObjC.h"</span><span class="cp"></span>
</td><td class="n" data-n="21" id="C80653NL21"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="cp">#include</span> <span class="cpf">"clang/AST/DeclObjC.h"</span><span class="cp"></span>
</td></tr><tr data-sigil="context-target"><td class="show-more" colspan="6">Context not available.</td></tr><tr><td class="n" data-n="736" id="C80653OL736"></td><td class="" data-copy-mode="copy-l">    <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">&amp;&amp;</span> <span class="n">method</span><span class="o">-&gt;</span><span class="n">isInstance</span><span class="p">())</span>
</td><td class="n" data-n="737" id="C80653NL737"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">    <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">&amp;&amp;</span> <span class="n">method</span><span class="o">-&gt;</span><span class="n">isInstance</span><span class="p">())</span>
</td></tr><tr><td class="n" data-n="737" id="C80653OL737"></td><td class="" data-copy-mode="copy-l">      <span class="n">ThisTy</span> <span class="o">=</span> <span class="n">method</span><span class="o">-&gt;</span><span class="n">getThisType</span><span class="p">(</span><span class="n">Context</span><span class="p">);</span>
</td><td class="n" data-n="738" id="C80653NL738"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">      <span class="n">ThisTy</span> <span class="o">=</span> <span class="n">method</span><span class="o">-&gt;</span><span class="n">getThisType</span><span class="p">(</span><span class="n">Context</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="738" id="C80653OL738"></td><td class="" data-copy-mode="copy-l">  <span class="p">}</span>
</td><td class="n" data-n="739" id="C80653NL739"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span>
</td></tr><tr><td class="old n" data-n="739" id="C80653OL739"></td><td class="old" data-copy-mode="copy-l">  
</td><td class="new n" data-n="740" id="C80653NL740"></td><td class="copy"></td><td class="new" colspan="2" data-copy-mode="copy-r">  <span class="bright"></span><span class="k"><span class="bright">if</span></span><span class="bright"> </span><span class="p"><span class="bright">(</span></span><span class="bright"></span><span class="n"><span class="bright">ThisTy</span></span><span class="bright"></span><span class="p"><span class="bright">.</span></span><span class="bright"></span><span class="n"><span class="bright">isNull</span></span><span class="bright"></span><span class="p"><span class="bright">())</span></span><span class="bright"> </span><span class="p"><span class="bright">{</span></span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="741" id="C80653NL741"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">    <span class="k">if</span> <span class="p">(</span><span class="n">isGenericLambdaCallOperatorSpecialization</span><span class="p">(</span><span class="n">CurContext</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="742" id="C80653NL742"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">        <span class="n">CurContext</span><span class="o">-&gt;</span><span class="n">getParent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getParent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isRecord</span><span class="p">())</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="743" id="C80653NL743"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// This is a generic lambda call operator that is being instantiated</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="744" id="C80653NL744"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// within an NSDMI - use the enclosing class as 'this'. There is no </span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="745" id="C80653NL745"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// enclosing member function to retrieve the 'this' pointer from.</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="746" id="C80653NL746"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="n">QualType</span> <span class="n">ClassTy</span> <span class="o">=</span> <span class="n">Context</span><span class="p">.</span><span class="n">getTypeDeclType</span><span class="p">(</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="747" id="C80653NL747"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">          <span class="n">cast</span><span class="o">&lt;</span><span class="n">CXXRecordDecl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CurContext</span><span class="o">-&gt;</span><span class="n">getParent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getParent</span><span class="p">()));</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="748" id="C80653NL748"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// Unlike for within methods, we don't have to worry about adding</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="749" id="C80653NL749"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// CVR qualifications in this context.  Just get the pointer to</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="750" id="C80653NL750"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="c1">// the enclosing class.</span>
</td></tr><tr class="inline" data-meta="2_4" data-sigil="inline-row"><td class="n"></td><td class="left"></td><td class="n"><a class="reveal-inline" data-mustcapture="1" data-sigil="reveal-inline" href="#"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-comment" data-meta="2_0" data-sigil="has-tooltip"></span></a></td><td class="copy"></td><td colspan="2" id="anchor-inline-32905"><a class="differential-inline-comment-anchor" id="inline-32905" name="inline-32905"></a><div class="differential-inline-comment inline-comment-element" data-meta="2_3" data-sigil="differential-inline-comment"><div class="differential-inline-comment-head grouped" data-sigil="differential-inline-header"><div class="inline-head-left">rsmith<span class="phui-tag-view phui-tag-type-shade phui-tag-red phui-tag-slim phui-tag-shade mml inline-draft-text"><span class="phui-tag-core">Unsubmitted</span></span></div><div class="inline-head-right"><div class="done-label button-not-done">Not Done</div><span class="phui-button-bar phui-button-bar-borderless inline-button-divider"><a class="button has-icon phui-button-default phui-button-bar-first" data-meta="2_1" data-mustcapture="1" data-sigil="has-tooltip differential-inline-reply" role="button"><span class="aural-only">Reply</span><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-reply" data-meta="2_2"></span></a><a class="button button-grey dropdown icon-last phui-button-default phui-button-bar-last" data-sigil="inline-action-dropdown" role="button"><span class="aural-only">Inline Actions</span><span class="caret"></span></a></span></div></div><div class="differential-inline-comment-content"><div class="phabricator-remarkup"><p>Instead of these comments, I'd say "There are no cv-qualifiers, per [expr.prim.general]p4." Also, please use "default initializer" rather than "NSDMI".</p></div></div></div><div class="differential-inline-summary"><strong>rsmith:</strong> Instead of these comments, I'd say "There are no cv-qualifiers, per [expr.prim.general]p4."â€¦</div></td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="751" id="C80653NL751"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">      <span class="k">return</span> <span class="n">Context</span><span class="p">.</span><span class="n">getPointerType</span><span class="p">(</span><span class="n">ClassTy</span><span class="p">);</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="752" id="C80653NL752"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">    <span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="753" id="C80653NL753"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="p">}</span>
</td></tr><tr><td class="n" data-n="740" id="C80653OL740"></td><td class="" data-copy-mode="copy-l">  <span class="k">return</span> <span class="n">ThisTy</span><span class="p">;</span>
</td><td class="n" data-n="754" id="C80653NL754"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">  <span class="k">return</span> <span class="n">ThisTy</span><span class="p">;</span>
</td></tr><tr><td class="n" data-n="741" id="C80653OL741"></td><td class="" data-copy-mode="copy-l"><span class="p">}</span>
</td><td class="n" data-n="755" id="C80653NL755"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n" data-n="742" id="C80653OL742"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="756" id="C80653NL756"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr data-sigil="context-target"><td class="show-more" colspan="6">Context not available.</td></tr></tbody></table></div></div><div class="differential-changeset" data-autoid="autoid_6" data-meta="0_85" data-sigil="differential-changeset" id="diff-change-kMBxIITUdfpn"><legend class="phabricator-anchor-navigation-marker" data-meta="0_83" data-sigil="marker"></legend><a class="phabricator-anchor-view" id="change-kMBxIITUdfpn" name="change-kMBxIITUdfpn"></a><h1 class="differential-file-icon-header" data-sigil="changeset-header"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-file-text-o" data-meta="0_84"></span><span class="differential-changeset-path-name" data-sigil="changeset-header-path-name">test/SemaCXX/cxx1y-generic-lambdas-capturing.cpp</span></h1><div class="changeset-view-content" data-sigil="changeset-view-content"><table class="differential-diff remarkup-code PhabricatorMonospaced diff-2up" data-sigil="differential-diff intercept-copy"><colgroup><col class="num"/><col class="left"/><col class="num"/><col class="copy"/><col class="right"/><col class="cov"/></colgroup><tbody><tr data-sigil="context-target"><td class="show-more" colspan="6">Context not available.</td></tr><tr><td class="n" data-n="1358" id="C80654OL1358"></td><td class="" data-copy-mode="copy-l"><span></span><span class="kt">int</span> <span class="n">run_char</span> <span class="o">=</span> <span class="n">X</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{}.</span><span class="n">foo</span><span class="p">(</span><span class="sc">'a'</span><span class="p">);</span>
</td><td class="n" data-n="1358" id="C80654NL1358"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span></span><span class="kt">int</span> <span class="n">run_char</span> <span class="o">=</span> <span class="n">X</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{}.</span><span class="n">foo</span><span class="p">(</span><span class="sc">'a'</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="1359" id="C80654OL1359"></td><td class="" data-copy-mode="copy-l"><span class="kt">int</span> <span class="n">run_int</span> <span class="o">=</span> <span class="n">X</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{}.</span><span class="n">foo</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</td><td class="n" data-n="1359" id="C80654NL1359"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="kt">int</span> <span class="n">run_int</span> <span class="o">=</span> <span class="n">X</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{}.</span><span class="n">foo</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</td></tr><tr><td class="n" data-n="1360" id="C80654OL1360"></td><td class="" data-copy-mode="copy-l"><span class="p">}</span>
</td><td class="n" data-n="1360" id="C80654NL1360"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1361" id="C80654NL1361"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">namespace</span> <span class="nn">nsdmi_capturing_this</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1362" id="C80654NL1362"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">X</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1363" id="C80654NL1363"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1364" id="C80654NL1364"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">auto</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m</span><span class="p">;</span> <span class="p">}(</span><span class="mi">20</span><span class="p">);</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1365" id="C80654NL1365"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n" data-n="1361" id="C80654OL1361"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="1366" id="C80654NL1366"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1367" id="C80654NL1367"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1368" id="C80654NL1368"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="k">struct</span> <span class="nc">XT</span> <span class="p">{</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1369" id="C80654NL1369"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="n">T</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1370" id="C80654NL1370"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">  <span class="n">T</span> <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">auto</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m</span><span class="p">;</span> <span class="p">}(</span><span class="mi">20</span><span class="p">);</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1371" id="C80654NL1371"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1372" id="C80654NL1372"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1373" id="C80654NL1373"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="n">XT</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">xt</span><span class="p">{};</span>
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1374" id="C80654NL1374"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1375" id="C80654NL1375"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class="n"></td><td class="" data-copy-mode="copy-l"></td><td class="new new-full n" data-n="1376" id="C80654NL1376"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span class="p">}</span>
</td></tr><tr><td class="n" data-n="1362" id="C80654OL1362"></td><td class="" data-copy-mode="copy-l"><span class="cp">#endif </span><span class="c1">// MS_EXTENSIONS</span>
</td><td class="n" data-n="1377" id="C80654NL1377"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span class="cp">#endif </span><span class="c1">// MS_EXTENSIONS</span>
</td></tr><tr><td class="n" data-n="1363" id="C80654OL1363"></td><td class="" data-copy-mode="copy-l">
</td><td class="n" data-n="1378" id="C80654NL1378"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r">
</td></tr><tr data-sigil="context-target"><td class="show-more" colspan="6">Context not available.</td></tr></tbody></table></div></div></div></div></div></div></div></div><div class="phui-formation-view-expander phui-formation-view-expander-left" data-autoid="autoid_2" data-meta="0_93" data-sigil="has-tooltip" id="UQ0_45" style=""><div class="phui-formation-view-expander-icon"><span aria-hidden="true" class="visual-only phui-icon-view phui-font-fa fa-chevron-right grey" data-meta="0_92"></span></div></div></td></tr></tbody></table></div></div></div><script src="overrides/js/core.pkg.js" type="text/javascript"></script><script src="overrides/js/differential.pkg.js" type="text/javascript"></script><data data-javelin-init-data='{"block":0,"data":[[],{"keyCommand":"t"},[],{"keyCommand":"f"},[],{"keyCommand":"?"},[],[],[],{"hoverPHID":"PHID-USER-wwlshrkez5hm5w2gouav"},{"hoverPHID":"PHID-USER-zo6g5h5wbnlemcs3hyxe"},{"tip":"Accepted","size":240},{"tip":"Review Requested","size":240},[],{"tabMap":["UQ0_10"]},{"hoverPHID":"PHID-MLST-u552v27ov5ow7holklm7"},{"phid":"PHID-XACT-DREV-izvfyqc6sb7ihwu"},{"phid":"PHID-XACT-DREV-qxufvqtvgpnyqn5"},{"tip":"Via Web"},[],[],[],[],[],[],[],{"phid":"PHID-XACT-DREV-wxy5k7rjbf7c7iq","anchor":"46282"},{"tip":"Via Web"},[],[],[],[],[],{"phid":"PHID-XACT-DREV-f3f5inidkv6qzvj","anchor":"46840"},{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-cqqnnvwdzp45kzx","anchor":"46843"},{"targetID":"UQ0_1","uri":"\/transactions\/quote\/PHID-XACT-DREV-qxufvqtvgpnyqn5\/","ref":"D3935#46865"},[],{"anchor":"46865"},[],{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_13\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"#\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-quote\" data-meta=\"0_37\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-quote-left phabricator-action-view-icon\" data-meta=\"0_38\" aria-hidden=\"true\"\u003e\u003c\/span\u003eQuote Comment\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_15\" class=\"phabricator-action-view phabricator-action-view-href action-has-icon\" style=\"\"\u003e\u003ca href=\"\/transactions\/raw\/PHID-XACT-DREV-qxufvqtvgpnyqn5\/\" class=\"phabricator-action-view-item\" data-sigil=\"transaction-raw\" data-meta=\"0_39\"\u003e\u003cspan class=\"visual-only phui-icon-view phui-font-fa fa-code phabricator-action-view-icon\" data-meta=\"0_40\" aria-hidden=\"true\"\u003e\u003c\/span\u003eView Raw Remarkup\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"tip":"Via Web"},[],{"phid":"PHID-XACT-DREV-46m6mlbev77hxap","anchor":"46865"},[],[],[],[],{"itemIDs":["UQ0_23","UQ0_24"],"caretID":"UQ0_22"},[],[],[],{"itemIDs":["UQ0_29"],"caretID":"UQ0_28"},[],[],[],[],[],{"anchor":"toc"},[],[],[],[],[],{"id":"diff-change-JoWlj7kxlaXi"},[],[],[],[],{"id":"diff-change-kMBxIITUdfpn"},{"tabMap":{"files":"UQ0_40","history":"UQ0_41","commits":"UQ0_42"}},{"tabKey":"files"},{"tabKey":"history"},{"tabKey":"commits"},{"standaloneURI":"\/differential\/changeset\/?ref=80653","leftURI":"\/differential\/changeset\/?view=old&amp;ref=80653","rightURI":"\/differential\/changeset\/?view=new&amp;ref=80653","containerID":"diff-change-JoWlj7kxlaXi"},[],{"anchor":"change-JoWlj7kxlaXi"},[],{"left":"80653","right":"80653","renderURI":"\/differential\/changeset\/","ref":"80653","autoload":true,"displayPath":"\u003cspan class=\"diff-banner-path\"\u003elib\/Sema\/\u003c\/span\u003e\u003cspan class=\"diff-banner-file\"\u003eSemaExprCXX.cpp\u003c\/span\u003e","icon":"fa-file-text-o","pathParts":["lib","Sema","SemaExprCXX.cpp"],"pathIconIcon":"fa-file-text-o","pathIconColor":"bluetext","isLowImportance":false,"isOwned":false,"editorURITemplate":null,"editorConfigureURI":null,"loaded":false,"changesetState":null,"showPathURI":null,"showDirectoryURI":null},{"standaloneURI":"\/differential\/changeset\/?ref=80654","leftURI":"\/differential\/changeset\/?view=old&amp;ref=80654","rightURI":"\/differential\/changeset\/?view=new&amp;ref=80654","containerID":"diff-change-kMBxIITUdfpn"},[],{"anchor":"change-kMBxIITUdfpn"},[],{"left":"80654","right":"80654","renderURI":"\/differential\/changeset\/","ref":"80654","autoload":true,"displayPath":"\u003cspan class=\"diff-banner-path\"\u003etest\/SemaCXX\/\u003c\/span\u003e\u003cspan class=\"diff-banner-file\"\u003ecxx1y-generic-lambdas-capturing.cpp\u003c\/span\u003e","icon":"fa-file-text-o","pathParts":["test","SemaCXX","cxx1y-generic-lambdas-capturing.cpp"],"pathIconIcon":"fa-file-text-o","pathIconColor":"bluetext","isLowImportance":false,"isOwned":false,"editorURITemplate":null,"editorConfigureURI":null,"loaded":false,"changesetState":null,"showPathURI":null,"showDirectoryURI":null},{"menuID":"UQ0_0"},[],[],[],[],[],[],{"tip":null,"align":"E"},{"items":[{"itemID":"UQ0_2","width":240,"isVisible":false,"isRightAligned":false,"expanderID":"UQ0_45","resizer":{"itemID":"UQ0_7","controlID":"UQ0_8","widthKey":null,"visibleKey":null,"minimumWidth":150,"maximumWidth":512},"column":{"type":"flank","nodeID":"UQ0_6","isFixed":true,"headID":"UQ0_3","bodyID":"UQ0_4","tailID":"UQ0_5"}},{"itemID":"UQ0_7","width":8,"isVisible":false,"isRightAligned":null,"expanderID":null,"resizer":null,"column":null},{"itemID":"UQ0_9","width":null,"isVisible":true,"isRightAligned":null,"expanderID":null,"resizer":null,"column":null}]},{"map":{"UQ0_46":"phabricator-search-menu-expanded","UQ0_63":"menu-icon-selected"}},{"items":"\u003cul class=\"phabricator-action-list-view \"\u003e\u003cli id=\"UQ0_48\" class=\"phabricator-action-view phabricator-action-view-type-label\" style=\"\"\u003e\u003cspan class=\"phabricator-action-view-item\"\u003eQueries\u003c\/span\u003e\u003c\/li\u003e\u003cli id=\"UQ0_50\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/VwhkLxBeXCJ6\/\" class=\"phabricator-action-view-item\"\u003eActive Revisions, recently changed first\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_52\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/all\/\" class=\"phabricator-action-view-item\"\u003eAll Revisions\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_54\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/kpppzQLwFaBm\/\" class=\"phabricator-action-view-item\"\u003eMLIR Open Revisions\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_56\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/M5vQzZOH04.6\/\" class=\"phabricator-action-view-item\"\u003eLibc++ Open Reviews\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_58\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/cHsGxkHENcUs\/\" class=\"phabricator-action-view-item\"\u003eLibc++ Open Reviews - Review Needed\u003c\/a\u003e\u003c\/li\u003e\u003cli id=\"UQ0_60\" class=\"phabricator-action-view phabricator-action-view-type-label\" style=\"\"\u003e\u003cspan class=\"phabricator-action-view-item\"\u003eSearch\u003c\/span\u003e\u003c\/li\u003e\u003cli id=\"UQ0_62\" class=\"phabricator-action-view phabricator-action-view-href phabricator-action-view-type-link\" style=\"\"\u003e\u003ca href=\"\/differential\/query\/advanced\/\" class=\"phabricator-action-view-item\"\u003eAdvanced Search\u003c\/a\u003e\u003c\/li\u003e\u003c\/ul\u003e"},[],{"items":[{"name":"Search"},{"icon":"fa-globe","name":"All Documents","value":"all"},{"icon":"fa-cog","name":"Current Application","value":"application"},{"name":"Saved Queries"},{"icon":"fa-certificate","name":"Open Documents","value":"open"},{"icon":"fa-certificate","name":"Open Tasks","value":"open-tasks"},{"name":"More Options"},{"icon":"fa-search-plus","name":"Advanced Search","href":"\/search\/query\/advanced\/"},{"icon":"fa-book","name":"User Guide: Search","href":"https:\/\/secure.phabricator.com\/diviner\/find\/?name=Search%20User%20Guide&amp;type=article&amp;jump=1"}],"icon":"fa-globe","value":"all"},[]]}' data-javelin-init-kind="merge"></data><data data-javelin-init-data='{"refresh-csrf":[{"tokenName":"__csrf__","header":"X-Phabricator-Csrf","viaHeader":"X-Phabricator-Via","current":"B@zyrfslti4d82c100b9f6fc90"}],"history-install":[]}' data-javelin-init-kind="behaviors"></data><data data-javelin-init-data='{"phui-hovercards":[],"phabricator-tooltips":[],"phui-tab-group":[],"phabricator-transaction-list":[],"phabricator-show-older-transactions":[{"timelineID":"UQ0_11","viewData":{"left":"9862","right":"9862","old":"80653,80654","new":"80653,80654"}}],"phabricator-watch-anchor":[],"phui-dropdown-menu":[],"phui-submenu":[],"differential-diff-radios":[{"radios":["UQ0_43"]}],"phabricator-oncopy":[],"differential-populate":[{"changesetViewIDs":["diff-change-JoWlj7kxlaXi","diff-change-kMBxIITUdfpn"],"formationViewID":"UQ0_44","inlineURI":null,"inlineListURI":"\/differential\/revision\/inlines\/3935\/","isStandalone":null,"pht":{"Open in Editor":"Open in Editor","Show All Context":"Show All Context","All Context Shown":"All Context Shown","Expand File":"Expand File","Hide Changeset":"Hide Changeset","Show Path in Repository":"Show Path in Repository","Show Directory in Repository":"Show Directory in Repository","View Standalone":"View Standalone","Show Raw File (Left)":"Show Raw File (Left)","Show Raw File (Right)":"Show Raw File (Right)","Configure Editor":"Configure Editor","Load Changes":"Load Changes","View Side-by-Side Diff":"View Side-by-Side Diff","View Unified Diff":"View Unified Diff","Change Text Encoding...":"Change Text Encoding...","Highlight As...":"Highlight As...","View As Document Type...":"View As Document Type...","Loading...":"Loading...","Editing Comment":"Editing Comment","Jump to next change.":"Jump to next change.","Jump to previous change.":"Jump to previous change.","Jump to next file.":"Jump to next file.","Jump to previous file.":"Jump to previous file.","Jump to next inline comment.":"Jump to next inline comment.","Jump to previous inline comment.":"Jump to previous inline comment.","Jump to the table of contents.":"Jump to the table of contents.","Edit selected inline comment.":"Edit selected inline comment.","You must select a comment to edit.":"You must select a comment to edit.","Reply to selected inline comment or change.":"Reply to selected inline comment or change.","You must select a comment or change to reply to.":"You must select a comment or change to reply to.","Reply and quote selected inline comment.":"Reply and quote selected inline comment.","Mark or unmark selected inline comment as done.":"Mark or unmark selected inline comment as done.","You must select a comment to mark done.":"You must select a comment to mark done.","Collapse or expand inline comment.":"Collapse or expand inline comment.","You must select a comment to hide.":"You must select a comment to hide.","Jump to next inline comment, including collapsed comments.":"Jump to next inline comment, including collapsed comments.","Jump to previous inline comment, including collapsed comments.":"Jump to previous inline comment, including collapsed comments.","Hide or show the current changeset.":"Hide or show the current changeset.","You must select a file to hide or show.":"You must select a file to hide or show.","Unsaved":"Unsaved","Unsubmitted":"Unsubmitted","Comments":"Comments","Hide \"Done\" Inlines":"Hide \"Done\" Inlines","Hide Collapsed Inlines":"Hide Collapsed Inlines","Hide Older Inlines":"Hide Older Inlines","Hide All Inlines":"Hide All Inlines","Show All Inlines":"Show All Inlines","List Inline Comments":"List Inline Comments","Display Options":"Display Options","Hide or show all inline comments.":"Hide or show all inline comments.","Finish editing inline comments before changing display modes.":"Finish editing inline comments before changing display modes.","Open file in external editor.":"Open file in external editor.","You must select a file to edit.":"You must select a file to edit.","You must select a file to open.":"You must select a file to open.","No external editor is configured.":"No external editor is configured.","Hide or show the paths panel.":"Hide or show the paths panel.","Show path in repository.":"Show path in repository.","Show directory in repository.":"Show directory in repository.","Jump to the comment area.":"Jump to the comment area.","Show Changeset":"Show Changeset","You must select source text to create a new inline comment.":"You must select source text to create a new inline comment.","New Inline Comment":"New Inline Comment","Add new inline comment on selected source text.":"Add new inline comment on selected source text.","Suggest Edit":"Suggest Edit","Discard Edit":"Discard Edit"}}],"workflow":[],"lightbox-attachments":[],"aphront-form-disable-on-submit":[],"toggle-class":[],"phabricator-gesture":[],"device":[],"high-security-warning":[{"show":false,"uri":"\/auth\/session\/downgrade\/","message":"Your session is in high security mode. When you finish using it, click here to leave."}],"phabricator-keyboard-shortcuts":[{"helpURI":"\/help\/keyboardshortcut\/","searchID":"UQ0_64","pht":{"\/":"Give keyboard focus to the search box.","?":"Show keyboard shortcut help for the current page."}}],"phabricator-search-typeahead":[{"id":"UQ0_65","input":"UQ0_64","button":"UQ0_66","selectorID":"UQ0_67","applicationID":"UQ0_68","defaultApplicationIcon":"fa-dot-circle-o","appScope":"application","src":"\/typeahead\/class\/PhabricatorSearchDatasource\/","limit":10,"placeholder":"Search","scopeUpdateURI":"\/settings\/adjust\/?key=search-scope"}],"quicksand-blacklist":[{"patterns":["\/phame\/live\/.*","\/conpherence\/.*","\/Z\\d+","\/file\/(data|download)\/.*","\/phortune\/.*","\/auth\/.*"]}]}' data-javelin-init-kind="behaviors"></data></body></html>